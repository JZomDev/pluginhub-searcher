package com.james.potsoundplugin;

import net.runelite.client.config.Config;
import net.runelite.client.config.ConfigGroup;
import net.runelite.client.config.ConfigItem;
import net.runelite.client.config.Range;

@ConfigGroup("potsound")
public interface PotSoundConfig extends Config {

	@Range(min = 0, max = 100)
	@ConfigItem(keyName = "potVolume", name = "Pot Sound Volume", description = "The volume of the pot sound", position = 1)
	default int potVolume() {
		return 100;
	}

}

package com.james.potsoundplugin;

import com.google.inject.Provides;
import javax.inject.Inject;
import lombok.extern.slf4j.Slf4j;
import net.runelite.api.Client;
import net.runelite.api.events.MenuOptionClicked;
import net.runelite.api.widgets.InterfaceID;
import net.runelite.client.config.ConfigManager;
import net.runelite.client.eventbus.Subscribe;
import net.runelite.client.plugins.Plugin;
import net.runelite.client.plugins.PluginDescriptor;
import net.runelite.client.util.Text;

import java.util.Arrays;
import java.util.HashSet;
import java.util.Set;
import java.util.concurrent.ScheduledExecutorService;

@Slf4j
@PluginDescriptor(name = "ToA Pot Sound")
public class PotSoundPlugin extends Plugin {
	private static final Set<Integer> TOA_REGIONS = new HashSet<>(Arrays.asList(
			13454, 14160, 14672, 15184, 15696, 14164, 14676, 15188, 15444, 15700, 15955, 15956, 16211));

	@Inject
	private Client client;

	@Inject
	private PotSoundConfig config;

	@Inject
	private ScheduledExecutorService executor;

	@Inject
	private SoundEngine soundEngine;

	@Override
	protected void startUp() {
		executor.submit(SoundFileManager::prepareSoundFiles);
	}

	@Subscribe
	public void onMenuOptionClicked(MenuOptionClicked event) {

		String option = event.getMenuOption();
		String target = Text.removeTags(event.getMenuTarget()).toLowerCase();

		boolean isToA = isInToA();
		boolean isDepositBoxOpen = client.getWidget(InterfaceID.DEPOSIT_BOX, 0) != null;

		boolean isDepositPotObject = target.contains("deposit pot");
		boolean isInterfaceDeposit = isDepositBoxOpen
				&& (option.startsWith("Deposit") || option.equals("Deposit inventory"));

		if (isToA) {
			if (isDepositPotObject && (option.equals("Deposit-inventory") || option.equals("Deposit-loot"))) {
				soundEngine.playClip(Sound.DEPOSIT, executor);
			} else if (isInterfaceDeposit) {
				soundEngine.playClip(Sound.DEPOSIT, executor);
			}
		}
	}

	private boolean isInToA() {
		int[] regions = client.getMapRegions();
		if (regions == null || regions.length == 0) {
			return false;
		}

		for (int region : regions) {
			if (TOA_REGIONS.contains(region)) {
				return true;
			}
		}
		return false;
	}

	@Provides
	PotSoundConfig provideConfig(ConfigManager configManager) {
		return configManager.getConfig(PotSoundConfig.class);
	}
}

package com.james.potsoundplugin;

import lombok.Getter;

@Getter
public enum Sound {
    DEPOSIT("deposit.wav");

    private final String resourceName;

    Sound(String resourceName) {
        this.resourceName = resourceName;
    }
}

package com.james.potsoundplugin;

import lombok.extern.slf4j.Slf4j;
import net.runelite.client.audio.AudioPlayer;

import javax.inject.Inject;
import javax.inject.Singleton;
import javax.sound.sampled.LineUnavailableException;
import javax.sound.sampled.UnsupportedAudioFileException;
import java.io.IOException;
import java.util.concurrent.Executor;

@Singleton
@Slf4j
public class SoundEngine {

    @Inject
    private PotSoundConfig config;

    @Inject
    private AudioPlayer audioPlayer;

    public void playClip(Sound sound, Executor executor) {
        executor.execute(() -> playClip(sound));
    }

    private void playClip(Sound sound) {
        float gain = 20f * (float) Math.log10(config.potVolume() / 100f);

        try {
            audioPlayer.play(SoundFileManager.getSoundFile(sound), gain);
        } catch (IOException | UnsupportedAudioFileException | LineUnavailableException e) {
            log.warn("Failed to play sound {}", sound, e);
        }
    }
}

package com.james.potsoundplugin;

import lombok.extern.slf4j.Slf4j;
import net.runelite.client.RuneLite;

import java.io.File;
import java.io.IOException;
import java.io.InputStream;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.StandardCopyOption;

@Slf4j
public class SoundFileManager {
    private static final Path SOUND_DIR = Path.of(RuneLite.RUNELITE_DIR.getPath(), "toa-pot-sounds");

    private SoundFileManager() {
        // Utility class
    }

    public static File getSoundFile(Sound sound) {
        return SOUND_DIR.resolve(sound.getResourceName()).toFile();
    }

    public static void prepareSoundFiles() {
        ensureDirectoryExists();
        for (Sound sound : Sound.values()) {
            extractIfMissing(sound);
        }
    }

    private static void ensureDirectoryExists() {
        try {
            if (!Files.exists(SOUND_DIR)) {
                Files.createDirectories(SOUND_DIR);
            }
        } catch (IOException e) {
            log.error("Could not create sound directory", e);
        }
    }

    private static void extractIfMissing(Sound sound) {
        File destFile = getSoundFile(sound);
        if (destFile.exists()) {
            return;
        }

        String resourcePath = "/" + sound.getResourceName();
        try (InputStream is = SoundFileManager.class.getResourceAsStream(resourcePath)) {
            if (is == null) {
                log.error("Sound resource not found: {}", resourcePath);
                return;
            }
            Files.copy(is, destFile.toPath(), StandardCopyOption.REPLACE_EXISTING);
            log.debug("Extracted sound file: {}", destFile.getPath());
        } catch (IOException e) {
            log.error("Failed to extract sound file: {}", sound.getResourceName(), e);
        }
    }
}

package com.james.potsoundplugin;

import net.runelite.client.RuneLite;
import net.runelite.client.externalplugins.ExternalPluginManager;

public class PotSoundPluginTest {
	@SuppressWarnings("unchecked")
	public static void main(String[] args) throws Exception {
		ExternalPluginManager.loadBuiltin(PotSoundPlugin.class);
		RuneLite.main(args);
	}
}
