package com.membershipalert;

import net.runelite.client.config.Config;
import net.runelite.client.config.ConfigGroup;
import net.runelite.client.config.ConfigItem;

import java.awt.*;

@ConfigGroup("membership-alet")
public interface MembershipAlertConfig extends Config {
    @ConfigItem(
            keyName = "membership-days-danger",
            name = "Danger days",
            description = "On how many days to show the danger color"
    )
    default int DangerDays() {
        return 1;
    }

    @ConfigItem(
            keyName = "membership-color-danger",
            name = "Danger color",
            description = "The color to use for the title on danger"
    )
    default Color DangerColor() {
        return Color.RED;
    }

    @ConfigItem(
            keyName = "membership-days-warning",
            name = "Warning days",
            description = "On how many days to show the warning color"
    )
    default int WarningDays() {
        return 3;
    }

    @ConfigItem(
            keyName = "membership-color-warning",
            name = "Warning color",
            description = "The color to use for the title on warning"
    )
    default Color WarningColor() {
        return Color.ORANGE;
    }

    @ConfigItem(
            keyName = "membership-color-success",
            name = "Success color",
            description = "The color to use for the title when we're good on membership days"
    )
    default Color SuccessColor() {
        return Color.GREEN;
    }
}

package com.membershipalert;

import javax.inject.Inject;

import net.runelite.api.Client;
import net.runelite.client.ui.overlay.Overlay;
import net.runelite.client.ui.overlay.OverlayPosition;
import net.runelite.client.ui.overlay.components.LineComponent;
import net.runelite.client.ui.overlay.components.PanelComponent;
import net.runelite.client.ui.overlay.components.TitleComponent;

import java.awt.*;

class MembershipAlertOverlay extends Overlay {
    private final Client client;
    private final MembershipAlertConfig config;
    private final PanelComponent panelComponent = new PanelComponent();

    private int memberShipDays = 0;

    @Inject
    private MembershipAlertOverlay(Client client, MembershipAlertConfig config) {
        setPosition(OverlayPosition.ABOVE_CHATBOX_RIGHT);
        this.client = client;
        this.config = config;
    }

    @Override
    public Dimension render(Graphics2D graphics) {
        panelComponent.getChildren().clear();
        String overlayTitle = "Membership:";
        Color color = config.DangerColor();

        if (memberShipDays > config.DangerDays()) {
            color = config.WarningColor();
        }

        if (memberShipDays > config.WarningDays()) {
            color = config.SuccessColor();
        }

        panelComponent.getChildren().add(TitleComponent.builder()
                .text(overlayTitle)
                .color(color)
                .build());

        panelComponent.setPreferredSize(new Dimension(
                graphics.getFontMetrics().stringWidth(overlayTitle) + 30,
                0));

        panelComponent.getChildren().add(LineComponent.builder()
                .left("Days left:")
                .right(Integer.toString(memberShipDays))
                .build());

        return panelComponent.render(graphics);
    }

    public void updateMembershipDays(int memberShipDays) {
        this.memberShipDays = memberShipDays;
    }
}

package com.membershipalert;

import com.google.inject.Provides;
import javax.inject.Inject;

import lombok.extern.slf4j.Slf4j;
import net.runelite.api.ChatMessageType;
import net.runelite.api.Client;
import net.runelite.api.VarPlayer;
import net.runelite.api.events.VarbitChanged;
import net.runelite.client.config.ConfigManager;
import net.runelite.client.eventbus.Subscribe;
import net.runelite.client.plugins.Plugin;
import net.runelite.client.plugins.PluginDescriptor;
import net.runelite.client.ui.overlay.OverlayManager;

@Slf4j
@PluginDescriptor(
        name = "Membership alert"
)
public class MembershipAlertPlugin extends Plugin {
    @Inject
    private Client client;

    @Inject
    private MembershipAlertConfig config;

    @Inject
    private MembershipAlertOverlay overlay;

    @Inject
    private OverlayManager overlayManager;

    private int membershipDays = 0;

    @Override
    protected void startUp() throws Exception {
        log.debug("Membership alert started!");
        overlayManager.add(overlay);
        membershipDays = client.getVarpValue(VarPlayer.MEMBERSHIP_DAYS);
    }

    @Override
    protected void shutDown() throws Exception {
        overlayManager.remove(overlay);
        log.debug("Membership alert stopped!");
    }
    @Subscribe
    public void onVarbitChanged(VarbitChanged varBitChanged ) {
        if(varBitChanged.getVarpId()==VarPlayer.MEMBERSHIP_DAYS) {
            int memDays = client.getVarpValue(VarPlayer.MEMBERSHIP_DAYS);
            if (memDays != membershipDays) {
                membershipDays = memDays;
                client.addChatMessage(ChatMessageType.GAMEMESSAGE, "Membership days2", "Membership days left: " + membershipDays, null);
                overlay.updateMembershipDays(memDays);
                overlayManager.resetOverlay(overlay);
            }
        }
    }

    @Provides
    MembershipAlertConfig provideConfig(ConfigManager configManager) {
        return configManager.getConfig(MembershipAlertConfig.class);
    }
}

package com.membershipalert;

import net.runelite.client.RuneLite;
import net.runelite.client.externalplugins.ExternalPluginManager;

public class MemberShipAlertPluginTest
{
	public static void main(String[] args) throws Exception
	{
		ExternalPluginManager.loadBuiltin(MembershipAlertPlugin.class);
		RuneLite.main(args);
	}
}
