package com.gimsieder.skillingoutfit;

import net.runelite.client.config.*;
import java.awt.*;

@ConfigGroup("skillingoutfit")
public interface SkillingOutfitConfig extends Config
{
	// 2. Panel Title Spacer (formerly yOffset)
	@ConfigItem(
			keyName = "panelTitleSpacer",
			name = "Panel Title Spacer",
			description = "How far the Title is from the top of the screen",
			position = 2
	)
	default int panelTitleSpacer()
	{
		return 20;
	}

	// 3. Display Collected Outfits
	@ConfigItem(
			keyName = "displayCollectedOutfits",
			name = "Display Collected Outfits",
			description = "Show the total number of outfits collected at the top of the panel",
			position = 3
	)
	default boolean displayCollectedOutfits()
	{
		return false;
	}

	// 4. Outfit Text Spacer (formerly LINE_SPACING_HALF)
	@ConfigItem(
			keyName = "outfitTextSpacer",
			name = "Outfit Text Spacer",
			description = "Spacing between panel title/previous section and outfit text",
			position = 4
	)
	default int outfitTextSpacer()
	{
		return 10;
	}

	// 5. Display Collected Items
	@ConfigItem(
			keyName = "displayCollectedItems",
			name = "Display Collected Items",
			description = "Show the total number of items collected at the top of the panel",
			position = 5
	)
	default boolean displayCollectedItems()
	{
		return false;
	}

	// 6. Item Text Spacer (formerly LINE_SPACING_QUARTER)
	@ConfigItem(
			keyName = "itemTextSpacer",
			name = "Item Text Spacer",
			description = "Spacing between collected items line and next line",
			position = 6
	)
	default int itemTextSpacer()
	{
		return 6;
	}

	// 7. Color Text for Collected
	@ConfigItem(
			keyName = "colorTextForCollected",
			name = "Color Text For Collected",
			description = "Color-code collected totals based on percentage completed",
			position = 7
	)
	default boolean colorTextForCollected()
	{
		return false;
	}

	// 8. First Outfit Spacer
	@ConfigItem(
			keyName = "firstOutfitSpacer",
			name = "First Outfit Spacer",
			description = "Spacing between plugin title / collected outfits/items to first outfit title",
			position = 8
	)
	default int firstOutfitSpacer()
	{
		return 12;
	}

	// 9. Show Total Obtain
	@ConfigItem(
			keyName = "showTotalObtain",
			name = "Show Price To Obtain",
			description = "Show total requirements (like total Marks of Grace) below outfit name",
			position = 9
	)
	default boolean showTotalObtain()
	{
		return true;
	}

	// 10. Total Needed Text Spacer
	@ConfigItem(
			keyName = "totalNeededTextSpacer",
			name = "Total Needed Text Spacer",
			description = "Spacing between first outfit title and first icon row",
			position = 10
	)
	default int totalNeededTextSpacer()
	{
		return 6;
	}

	// 11. Icon Spacer
	@ConfigItem(
			keyName = "iconTextSpacer",
			name = "Icon Text Spacer",
			description = "Spacing between outfit text title / total needed and icons",
			position = 11
	)
	default int iconTextSpacer()
	{
		return 20;
	}

	// 12. Icon Size
	@ConfigItem(
			keyName = "iconSize",
			name = "Icon Size",
			description = "Size of each item icon in the panel",
			position = 12
	)
	default int iconSize()
	{
		return 48;
	}


	// 13. Icon Gap Spacing
	@ConfigItem(
			keyName = "iconGapSpacing",
			name = "Icon Size",
			description = "Size of each gap between each icon in the panel",
			position = 12
	)
	default int iconGapSpacing()
	{
		return 48;
	}

	// 14. Icon Column Count (maxCols)
	@ConfigItem(
			keyName = "maxCols",
			name = "Max Columns",
			description = "How many icons before going to next row",
			position = 14
	)
	default int maxCols()
	{
		return 5;
	}

	// 15. Show Obtained Items
	@ConfigItem(
			keyName = "showObtainedItems",
			name = "Show Obtained Items",
			description = "Show individual icons for items that are already obtained",
			position = 15
	)
	default boolean showObtainedItems()
	{
		return false;
	}

	// 16. Override Outfit Colors
	@ConfigItem(
			keyName = "overrideOutfitColors",
			name = "Override Outfit Colors",
			description = "If enabled, all outfit section names will use the chosen override color instead of green/red",
			position = 16
	)
	default boolean overrideOutfitColors()
	{
		return false;
	}

	// 17. Outfit Name Color
	@Alpha
	@ConfigItem(
			keyName = "outfitNameColor",
			name = "Outfit Name Color",
			description = "Color for outfit names when override is enabled",
			position = 17
	)
	default Color outfitNameColor()
	{
		return new Color(255, 255, 255, 255);
	}

	// 18-19 left blank if needed for future use

	// 20. Enable Popout Config Mode
	@ConfigItem(
			keyName = "enablePopoutConfigMode",
			name = "Enable Popout Config Mode",
			description = "Opens the config as a separate popout window for live tweaking",
			position = 20
	)
	default boolean enablePopoutConfigMode()
	{
		return false;
	}

	// 18. Anima Bark Setter
	@ConfigItem(
			keyName = "animaBark",
			name = "Anima-Infused Bark",
			description = "Set your current amount of Anima-Infused Bark",
			position = 18
	)
	default int animaBark()
	{
		return 0; // default starting value
	}

	// 19. Per Item Total Obtain
	@ConfigItem(
			keyName = "showItemTotalObtain",
			name = "Show Price To Obtain Items",
			description = "Show total requirements for each item that have dual requirements",
			position = 19
	)
	default boolean showItemTotalObtain()
	{
		return true;
	}

// ----------------------- Skip to Outfits Display -------------------------------

	@ConfigSection(
			name = "Outfit Sets",
			description = "Settings for displaying each outfit",
			position = 50
	)
	String displayoutfit = "Display Outfits";

	@ConfigItem(
			keyName = "displayAgility",
			name = "Display Agility Outfit",
			description = "Toggles if Agility set shows in panel display",
			position = 51,
			section = displayoutfit
	)
	default boolean displayAgility()
	{
		return true;
	}

	@ConfigItem(
			keyName = "displayConstruction",
			name = "Display Construction Outfit",
			description = "Toggles if Construction set shows in panel display",
			position = 52,
			section = displayoutfit
	)
	default boolean displayConstruction()
	{
		return true;
	}

	@ConfigItem(
			keyName = "displayFarming",
			name = "Display Farming Outfit",
			description = "Toggles if Farming set shows in panel display",
			position = 53,
			section = displayoutfit
	)
	default boolean displayFarming()
	{
		return true;
	}

	@ConfigItem(
			keyName = "displayFiremaking",
			name = "Display Firemaking Outfit",
			description = "Toggles if Firemaking set shows in panel display",
			position = 54,
			section = displayoutfit
	)
	default boolean displayFiremaking()
	{
		return true;
	}

	@ConfigItem(
			keyName = "displayFishing",
			name = "Display Fishing Outfit",
			description = "Toggles if Fishing set shows in panel display",
			position = 55,
			section = displayoutfit
	)
	default boolean displayFishing()
	{
		return true;
	}

	@ConfigItem(
			keyName = "displayHunter",
			name = "Display Hunter Outfit",
			description = "Toggles if Hunter set shows in panel display",
			position = 56,
			section = displayoutfit
	)
	default boolean displayHunter()
	{
		return true;
	}

	@ConfigItem(
			keyName = "displayMining",
			name = "Display Mining Outfit",
			description = "Toggles if Mining set shows in panel display",
			position = 57,
			section = displayoutfit
	)
	default boolean displayMining()
	{
		return true;
	}

	@ConfigItem(
			keyName = "displayPrayer",
			name = "Display Prayer Outfit",
			description = "Toggles if Prayer set shows in panel display",
			position = 58,
			section = displayoutfit
	)
	default boolean displayPrayer()
	{
		return true;
	}

	@ConfigItem(
			keyName = "displayRunecraft",
			name = "Display Runecraft Outfit",
			description = "Toggles if Runecraft set shows in panel display",
			position = 59,
			section = displayoutfit
	)
	default boolean displayRunecraft()
	{
		return true;
	}

	@ConfigItem(
			keyName = "displaySmithing",
			name = "Display Smithing Outfit",
			description = "Toggles if Smithing set shows in panel display",
			position = 60,
			section = displayoutfit
	)
	default boolean displaySmithing()
	{
		return true;
	}

	@ConfigItem(
			keyName = "displayThieving",
			name = "Display Thieving Outfit",
			description = "Toggles if Thieving set shows in panel display",
			position = 60,
			section = displayoutfit
	)
	default boolean displayThieving()
	{
		return true;
	}

	@ConfigItem(
			keyName = "displayWoodcutting",
			name = "Display Woodcutting Outfit",
			description = "Toggles if Woodcutting set shows in panel display",
			position = 60,
			section = displayoutfit
	)
	default boolean displayWoodcutting()
	{
		return true;
	}

}
package com.gimsieder.skillingoutfit;

import java.util.HashMap;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;

public class SkillingOutfitData
{
	public static final Map<String, SkillingOutfitDataEntry> OUTFITS_DATA = new LinkedHashMap<>();

	static
	{
		// Graceful Outfit
		Map<Integer, SkillingOutfitItem> graceful = new LinkedHashMap<>();
		graceful.put(11850, new SkillingOutfitItem(11850, "Graceful Hood", 35, "Marks of Grace", 11849, List.of(27444,27446,21061,21063,13579,13580,24743,24745,13627,13628,13667,13668,13603,13604,13591,13592,13615,13616,25069,25071,30045,30047,11851)));
		graceful.put(11854, new SkillingOutfitItem(11854, "Graceful Top", 55, "Marks of Grace", 11849, List.of(27450,27452,21067,21069,13583,13584,24749,24751,13631,13632,13671,13672,13607,13608,13595,13596,13619,13620,25075,25077,30051,30053,11855)));
		graceful.put(11856, new SkillingOutfitItem(11856, "Graceful Legs", 60, "Marks of Grace", 11849, List.of(27453,27455,21070,21072,13585,13586,24752,24754,13633,13634,13673,13674,13609,13610,13597,13598,13621,13622,25078,25080,30054,30056,11857)));
		graceful.put(11858, new SkillingOutfitItem(11858, "Graceful Gloves", 30, "Marks of Grace", 11849, List.of(27456,27458,21073,21075,13587,13588,24755,24757,13635,13636,13675,13676,13611,13612,13599,13600,13623,13624,25081,25083,30057,30059,11859)));
		graceful.put(11860, new SkillingOutfitItem(11860, "Graceful Boots", 40, "Marks of Grace", 11849, List.of(27459,27461,21076,21078,13589,13590,24758,24760,13637,13638,13677,13678,13613,13614,13601,13602,13625,13626,25084,25086,30060,30062,11861)));
		graceful.put(11852, new SkillingOutfitItem(11852, "Graceful Cape", 40, "Marks of Grace", 11849, List.of(27447,27449,21064,21066,13581,13582,24746,24748,13629,13630,13669,13670,13605,13606,13593,13594,13617,13618,25072,25074,30048,30050,11853)));
		OUTFITS_DATA.put("Agility - Graceful Outfit",
				new SkillingOutfitDataEntry("displayAgility", graceful, "https://oldschool.runescape.wiki/w/Graceful_outfit", "Agility"));

		// Carpenter's Outfit
		Map<Integer, SkillingOutfitItem> carpenter = new LinkedHashMap<>();
		carpenter.put(24872, new SkillingOutfitItem(24872, "Carpenter Helmet", 400, "Carpenter Points", 0));
		carpenter.put(24874, new SkillingOutfitItem(24874, "Carpenter Shirt", 800, "Carpenter Points", 0));
		carpenter.put(24876, new SkillingOutfitItem(24876, "Carpenter Trousers", 600, "Carpenter Points", 0));
		carpenter.put(24878, new SkillingOutfitItem(24878, "Carpenter Boots", 200, "Carpenter Points", 0));
		OUTFITS_DATA.put("Construction - Carpenter Outfit",
				new SkillingOutfitDataEntry("displayConstruction", carpenter, "https://oldschool.runescape.wiki/w/Carpenter's_outfit", "Construction"));

		// Farmer's Outfit A MALE
		Map<Integer, SkillingOutfitItem> farmera = new LinkedHashMap<>();
		farmera.put(13646, new SkillingOutfitItem(13646, "Farmer's Strawhat", 75, "Farming Points", 0));
		farmera.put(13642, new SkillingOutfitItem(13642, "Farmer's Jacket", 150, "Farming Points", 0));
		farmera.put(13640, new SkillingOutfitItem(13640, "Farmer's Boro Trousers", 125, "Farming Points", 0));
		farmera.put(13644, new SkillingOutfitItem(13644, "Farmer's Boots", 50, "Farming Points", 0));
		OUTFITS_DATA.put("Farming - Farmer's Outfit Male",
				new SkillingOutfitDataEntry("displayFarming", farmera, "https://oldschool.runescape.wiki/w/Farmer's_outfit#Body_Type_A", "Farming"));

		// Farmer's Outfit B FEMALE
		Map<Integer, SkillingOutfitItem> farmerb = new LinkedHashMap<>();
		farmerb.put(13647, new SkillingOutfitItem(13647, "Farmer's Strawhat", 75, "Farming Points", 0));
		farmerb.put(13643, new SkillingOutfitItem(13643, "Farmer's Shirt", 150, "Farming Points", 0));
		farmerb.put(13641, new SkillingOutfitItem(13641, "Farmer's Boro Trousers", 125, "Farming Points", 0));
		farmerb.put(13645, new SkillingOutfitItem(13645, "Farmer's Boots", 50, "Farming Points", 0));
		OUTFITS_DATA.put("Farming - Farmer's Outfit Female",
				new SkillingOutfitDataEntry("displayFarming", farmerb, "https://oldschool.runescape.wiki/w/Farmer's_outfit#Body_Type_B", "Farming"));

		// Pyromancer Outfit
		Map<Integer, SkillingOutfitItem> pyromancer = new LinkedHashMap<>();
		pyromancer.put(20708, new SkillingOutfitItem(20708, "Pyromancer Hood", 0, "Wintertodt - Reward Cart", 0));
		pyromancer.put(20704, new SkillingOutfitItem(20704, "Pyromancer Garb", 0, "Wintertodt - Reward Cart", 0));
		pyromancer.put(20706, new SkillingOutfitItem(20706, "Pyromancer Robe", 0, "Wintertodt - Reward Cart", 0));
		pyromancer.put(20710, new SkillingOutfitItem(20710, "Pyromancer Boots", 0, "Wintertodt - Reward Cart", 0));
		OUTFITS_DATA.put("Firemaking - Pyromancer Outfit",
				new SkillingOutfitDataEntry("displayFiremaking", pyromancer, "https://oldschool.runescape.wiki/w/Pyromancer_outfit", "Firemaking"));

		// Angler's Outfit
		Map<Integer, SkillingOutfitItem> angler = new LinkedHashMap<>();
		angler.put(13258, new SkillingOutfitItem(13258, "Angler Hat", 0, "Fishing Trawler - Reward Net", 0));
		angler.put(13259, new SkillingOutfitItem(13259, "Angler Top", 0, "Fishing Trawler - Reward Net", 0));
		angler.put(13260, new SkillingOutfitItem(13260, "Angler Waders", 0, "Fishing Trawler - Reward Net", 0));
		angler.put(13261, new SkillingOutfitItem(13261, "Angler Boots", 0, "Fishing Trawler - Reward Net", 0));
		OUTFITS_DATA.put("Fishing - Angler's Outfit",
				new SkillingOutfitDataEntry("displayFishing", angler, "https://oldschool.runescape.wiki/w/Angler's_outfit", "Fishing"));

		// Guild Hunter Outfit
		Map<Integer, SkillingOutfitItem> hunter = new LinkedHashMap<>();
		hunter.put(29263, new SkillingOutfitItem(29263, "Guild Hunter Headwear", 0, "Hunter Rumors", 0));
		hunter.put(29265, new SkillingOutfitItem(29265, "Guild Hunter Top", 0, "Hunter Rumors", 0));
		hunter.put(29267, new SkillingOutfitItem(29267, "Guild Hunter Legs", 0, "Hunter Rumors", 0));
		hunter.put(29269, new SkillingOutfitItem(29269, "Guild Hunter Boots", 0, "Hunter Rumors", 0));
		OUTFITS_DATA.put("Hunter - Guild Hunter Outfit",
				new SkillingOutfitDataEntry("displayHunter", hunter, "https://oldschool.runescape.wiki/w/Guild_hunter_outfit", "Hunter"));

		// Prospector Kit
		Map<Integer, SkillingOutfitItem> prospector = new LinkedHashMap<>();
		prospector.put(12013, new SkillingOutfitItem(12013, "Prospector Helmet", 40, "Gold Nuggets", 12012, List.of(25549,29472)));
		prospector.put(12014, new SkillingOutfitItem(12014, "Prospector Jacket", 60, "Gold Nuggets", 12012, List.of(25551,29474)));
		prospector.put(12015, new SkillingOutfitItem(12015, "Prospector Legs", 50, "Gold Nuggets", 12012, List.of(25553,29476)));
		prospector.put(12016, new SkillingOutfitItem(12016, "Prospector Boots", 30, "Gold Nuggets", 12012, List.of(25555,29478)));
		OUTFITS_DATA.put("Mining - Prospector Kit",
				new SkillingOutfitDataEntry("displayMining", prospector, "https://oldschool.runescape.wiki/w/Prospector_kit", "Mining"));

		// Prayer Robes
		Map<Integer, SkillingOutfitItem> prayer = new LinkedHashMap<>();
		prayer.put(25438, new SkillingOutfitItem(25438, "Zealot's Helmet", 0, "Shade Catacombs - Gold Chest", 0));
		prayer.put(25434, new SkillingOutfitItem(25434, "Zealot's Robe Top", 0, "Shade Catacombs - Gold Chest", 0));
		prayer.put(25436, new SkillingOutfitItem(25436, "Zealot's Robe Bottom", 0, "Shade Catacombs - Gold Chest", 0));
		prayer.put(25440, new SkillingOutfitItem(25440, "Zealot's  Boots", 0, "Shade Catacombs - Gold Chest", 0));
		OUTFITS_DATA.put("Prayer - Zealot's Robes",
				new SkillingOutfitDataEntry("displayPrayer", prayer, "https://oldschool.runescape.wiki/w/Zealot's_robes", "Prayer"));

		// Runecraft Robes
		Map<Integer, SkillingOutfitItem> runecraft = new LinkedHashMap<>();
		runecraft.put(26850, new SkillingOutfitItem(26850, "Hat Of The Eye", 400, "Abyssal Pearls", 26792, List.of(26858,26864,26870)));
		runecraft.put(26852, new SkillingOutfitItem(26852, "Robe Top Of The Eye", 350, "Abyssal Pearls", 26792, List.of(26860,26866,26872)));
		runecraft.put(26854, new SkillingOutfitItem(26854, "Robe Bottoms Of The Eye", 350, "Abyssal Pearls", 26792, List.of(26862,26868,26874)));
		runecraft.put(26856, new SkillingOutfitItem(26856, "Boots Of The Eye", 250, "Abyssal Pearls", 26792));
		OUTFITS_DATA.put("Runecraft - Raiments Of The Eye",
				new SkillingOutfitDataEntry("displayRunecraft", runecraft, "https://oldschool.runescape.wiki/w/Raiments_of_the_Eye", "Runecraft"));

		// Smith's Uniform
		Map<Integer, SkillingOutfitItem> smithing = new LinkedHashMap<>();
		smithing.put(27023, new SkillingOutfitItem(27023, "Smiths Tunic", 4000, "Foundry Reputation", 0));
		smithing.put(27025, new SkillingOutfitItem(27025, "Smiths Trousers", 4000, "Foundry Reputation", 0));
		smithing.put(27029, new SkillingOutfitItem(27029, "Smiths Gloves", 3500, "Foundry Reputation", 0, List.of(27031)));
		smithing.put(27027, new SkillingOutfitItem(27027, "Smiths Boots", 3500, "Foundry Reputation", 0));
		OUTFITS_DATA.put("Smithing - Smith's Uniform",
				new SkillingOutfitDataEntry("displaySmithing", smithing, "https://oldschool.runescape.wiki/w/Smiths'_Uniform", "Smithing"));

		// Rogue Equipment
		Map<Integer, SkillingOutfitItem> Thieving = new LinkedHashMap<>();
		Thieving.put(5554, new SkillingOutfitItem(5554, "Rogue Mask", 0, "Rogues' Den - Wall Safes", 0));
		Thieving.put(5553, new SkillingOutfitItem(5553, "Rogue Top", 0, "Rogues' Den - Wall Safes", 0));
		Thieving.put(5556, new SkillingOutfitItem(5556, "Rogue Gloves", 0, "Rogues' Den - Wall Safes", 0));
		Thieving.put(5555, new SkillingOutfitItem(5555, "Rogue Trousers", 0, "Rogues' Den - Wall Safes", 0));
		Thieving.put(5557, new SkillingOutfitItem(5557, "Rogue Boots", 0, "Rogues' Den - Wall Safes", 0));
		OUTFITS_DATA.put("Thieving - Rogue Equipment",
				new SkillingOutfitDataEntry("displayThieving", Thieving, "https://oldschool.runescape.wiki/w/Rogue_equipment", "Thieving"));

		// Lumberjack Outfit
		Map<Integer, SkillingOutfitItem> woodcutting = new LinkedHashMap<>();
		woodcutting.put(10941, new SkillingOutfitItem(10941, "Lumberjack Hat", 1200, "Anima-Infused Bark", 28134, List.of(28173)));
		woodcutting.put(10939, new SkillingOutfitItem(10939, "Lumberjack Top", 1500, "Anima-Infused Bark", 28134, List.of(28169)));
		woodcutting.put(10940, new SkillingOutfitItem(10940, "Lumberjack Legs", 1300, "Anima-Infused Bark", 28134, List.of(28171)));
		woodcutting.put(10933, new SkillingOutfitItem(10933, "Lumberjack Boots", 1000, "Anima-Infused Bark", 28134, List.of(28167)));
		OUTFITS_DATA.put("Woodcutting - Lumberjack Outfit",
				new SkillingOutfitDataEntry("displayWoodcutting", woodcutting, "https://oldschool.runescape.wiki/w/Lumberjack_outfit", "Woodcutting"));

	}

	// Inner class
	public static class SkillingOutfitDataEntry
	{
		public final String configKey;
		public final Map<Integer, SkillingOutfitItem> items;
		public final String wikiUrl;
		public final String primarySkill;

		public SkillingOutfitDataEntry(String configKey, Map<Integer, SkillingOutfitItem> items, String wikiUrl, String primarySkill)
		{
			this.configKey = configKey;
			this.items = items;
			this.wikiUrl = wikiUrl;
			this.primarySkill = primarySkill;
		}
	}

	// More than 1 cost item s
	public static final Map<Integer, List<SkillingOutfitItem.CostEntry>> EXTRA_COSTS = new HashMap<>();

	static
	{
		// -------------------------------
		// Extra costs for Lumberjack Outfit
		// -------------------------------
		EXTRA_COSTS.put(10941, List.of(
				new SkillingOutfitItem.CostEntry("Anima-Infused Bark", 1200, 28134),
				new SkillingOutfitItem.CostEntry("Yew Logs", 200, 1515),
				new SkillingOutfitItem.CostEntry("Magic Logs", 100, 1513)
		)); // Lumberjack Hat

		EXTRA_COSTS.put(10939, List.of(
				new SkillingOutfitItem.CostEntry("Anima-Infused Bark", 1500, 28134),
				new SkillingOutfitItem.CostEntry("Yew Logs", 60, 1515),
				new SkillingOutfitItem.CostEntry("Magic Logs", 120, 1513),
				new SkillingOutfitItem.CostEntry("Redwood Logs", 120, 19669)
		)); // Lumberjack Top

		EXTRA_COSTS.put(10940, List.of(
				new SkillingOutfitItem.CostEntry("Anima-Infused Bark", 1300, 28134),
				new SkillingOutfitItem.CostEntry("Yew Logs", 160, 1515),
				new SkillingOutfitItem.CostEntry("Magic Logs", 140, 1513)
		)); // Lumberjack Legs

		EXTRA_COSTS.put(10933, List.of(
				new SkillingOutfitItem.CostEntry("Anima-Infused Bark", 1000, 28134),
				new SkillingOutfitItem.CostEntry("Maple Logs", 100, 1517),
				new SkillingOutfitItem.CostEntry("Yew Logs", 200, 1515)
		)); // Lumberjack Boots
	}

}
package com.gimsieder.skillingoutfit;

import java.util.List;
import java.util.Objects;

public class SkillingOutfitItem
{
	private final int itemId;
	private final String name;
	private final int requirement;
	private final String costText;
	private final int costItemId;
	private final List<Integer> otherItemIds;

	// Constructor with otherItemIds
	public SkillingOutfitItem(int itemId, String name, int requirement, String costText, int costItemId, List<Integer> otherItemIds)
	{
		if (itemId < 0) throw new IllegalArgumentException("itemId must be non-negative");
		if (requirement < 0) throw new IllegalArgumentException("requirement must be non-negative");
		if (name == null || name.isEmpty()) throw new IllegalArgumentException("name cannot be null or empty");
		if (costText == null) throw new IllegalArgumentException("costText cannot be null");
		if (otherItemIds == null) throw new IllegalArgumentException("otherItemIds cannot be null");

		this.itemId = itemId;
		this.name = name;
		this.requirement = requirement;
		this.costText = costText;
		this.costItemId = costItemId;
		this.otherItemIds = List.copyOf(otherItemIds);

	}

	// Constructor without otherItemIds (defaults to empty list)
	public SkillingOutfitItem(int itemId, String name, int requirement, String costText, int costItemId)
	{
		this(itemId, name, requirement, costText, costItemId, List.of());
	}

	// ------------------------
	// Getters
	// ------------------------
	public int getItemId() { return itemId; }
	public String getName() { return name; }
	public int getRequirement() { return requirement; }
	public String getCostText() { return costText; }
	public int getCostItemId() { return costItemId; }
	public List<Integer> getOtherItemIds() { return otherItemIds; }

	// ------------------------
	// Overrides
	// ------------------------

	@Override
	public String toString()
	{
		return name + " (ID: " + itemId + ", Requirement: " + requirement + " " + costText + ", Other IDs: " + otherItemIds + ")";
	}

	@Override
	public boolean equals(Object o)
	{
		if (this == o) return true;
		if (!(o instanceof SkillingOutfitItem)) return false;
		SkillingOutfitItem that = (SkillingOutfitItem) o;
		return itemId == that.itemId &&
				requirement == that.requirement &&
				costItemId == that.costItemId &&
				name.equals(that.name) &&
				costText.equals(that.costText) &&
				otherItemIds.equals(that.otherItemIds);
	}

	@Override
	public int hashCode()
	{
		return Objects.hash(itemId, name, requirement, costText, costItemId, otherItemIds);
	}

	// ---------------------------
	// Public static CostEntry class
	// ---------------------------
	public static class CostEntry
	{
		private final String itemName;
		private final int amount;
		private final int itemId;

		public CostEntry(String itemName, int amount, int itemId)
		{
			this.itemName = itemName;
			this.amount = amount;
			this.itemId = itemId;
		}

		public String getItemName() { return itemName; }
		public int getAmount() { return amount; }
		public int getItemId() { return itemId; }
	}

}
package com.gimsieder.skillingoutfit;

import net.runelite.api.ChatMessageType;
import net.runelite.api.Client;
import net.runelite.api.Player;
import net.runelite.client.callback.ClientThread;
import net.runelite.client.config.ConfigManager;
import net.runelite.client.game.ItemManager;
import net.runelite.client.ui.PluginPanel;
import net.runelite.api.ChatMessageType;

import javax.swing.*;
import java.awt.*;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.awt.image.BufferedImage;
import java.net.URI;
import java.nio.charset.StandardCharsets;
import java.util.List;
import java.util.*;
import java.util.concurrent.ConcurrentHashMap;
import java.util.function.BooleanSupplier;
import java.util.stream.Collectors;

public class SkillingOutfitPanel extends PluginPanel
{
	private final Client client;
	private final ItemManager itemManager;
	private final SkillingOutfitTracker tracker;
	private final SkillingOutfitConfig config;
	private final ConfigManager configManager;
	private final SkillingOutfitPlugin plugin;
	private final ClientThread clientThread;

	private final Map<Integer, BufferedImage> itemSprites = new HashMap<>();
	private final Map<Integer, Rectangle> iconBounds = new HashMap<>();
	private final Map<String, Rectangle> outfitBounds = new HashMap<>();
	private final Map<String, BooleanSupplier> outfitDisplayMap = new HashMap<>();
	private final Map<String, Integer> remainingCounts = new HashMap<>();
	private final Map<Integer, SkillingOutfitItem> hoverItemMap = new HashMap<>();


	private final Map<Integer, Integer> inventoryCacheSnapshot = new ConcurrentHashMap<>();
	private final Map<Integer, Integer> equipmentCacheSnapshot = new ConcurrentHashMap<>();
	private final Map<Integer, Integer> bankCacheSnapshot = new ConcurrentHashMap<>();

	private JPanel innerPanel;
	private int hoveredItemId = -1;
	private String hoveredOutfitName = null;

	private static final Map<String, Color> SKILL_COLORS = Map.ofEntries(
			Map.entry("Agility", new Color(0x33FF33)),
			Map.entry("Construction", new Color(0xCC9966)),
			Map.entry("Farming", new Color(0x33CC33)),
			Map.entry("Firemaking", new Color(0xFF3300)),
			Map.entry("Fishing", new Color(0x3399FF)),
			Map.entry("Hunter", new Color(0x66CC00)),
			Map.entry("Mining", new Color(0x999999)),
			Map.entry("Prayer", new Color(0xFFFFFF)),
			Map.entry("Runecraft", new Color(0x996633)),
			Map.entry("Smithing", new Color(0xCCCCCC)),
			Map.entry("Thieving", new Color(0xFFFF00)),
			Map.entry("Woodcutting", new Color(0x996633)),
			Map.entry("Sailing", new Color(0x1EB4C7))
	);

	public SkillingOutfitPanel(Client client, ItemManager itemManager, SkillingOutfitTracker tracker,
							   SkillingOutfitConfig config, ConfigManager configManager,
							   SkillingOutfitPlugin plugin, ClientThread clientThread)
	{
		this.client = client;
		this.itemManager = itemManager;
		this.tracker = tracker;
		this.config = config;
		this.configManager = configManager;
		this.plugin = plugin;
		this.clientThread = clientThread;

		setBackground(new Color(40, 40, 40));
		setLayout(new BorderLayout());

		innerPanel = new JPanel() {
			@Override
			public Dimension getPreferredSize() {
				return calculatePreferredSize();
			}

			@Override
			protected void paintComponent(Graphics g) {
				super.paintComponent(g);
				paintItems((Graphics2D) g);
			}
		};
		innerPanel.setBackground(new Color(40, 40, 40));

		preloadSprites();
		setupOutfitDisplayMap();

		innerPanel.addMouseMotionListener(new java.awt.event.MouseMotionAdapter() {
			@Override
			public void mouseMoved(MouseEvent e) {
				hoveredItemId = getItemAt(e.getX(), e.getY());
				hoveredOutfitName = getOutfitAt(e.getX(), e.getY());
				innerPanel.repaint();
			}
		});

		innerPanel.addMouseListener(new MouseAdapter()
		{
			@Override
			public void mouseClicked(MouseEvent e)
			{
				int itemId = getItemAt(e.getX(), e.getY());
				if (itemId != -1)
				{
					// Open item wiki
					openWikiLink("https://oldschool.runescape.wiki/Special:Lookup?utm_source=wiki&type=item&id=" + itemId);
					return;
				}

				String outfitName = getOutfitAt(e.getX(), e.getY());
				if (outfitName != null)
				{
					SkillingOutfitData.SkillingOutfitDataEntry entry = SkillingOutfitData.OUTFITS_DATA.get(outfitName);
					if (entry != null && entry.wikiUrl != null && !entry.wikiUrl.isEmpty())
					{
						openWikiLink(entry.wikiUrl);
					}
				}
			}
		});

		JScrollPane scrollPane = new JScrollPane(innerPanel);
		scrollPane.setHorizontalScrollBarPolicy(ScrollPaneConstants.HORIZONTAL_SCROLLBAR_NEVER);
		scrollPane.setVerticalScrollBarPolicy(ScrollPaneConstants.VERTICAL_SCROLLBAR_AS_NEEDED);
		scrollPane.getVerticalScrollBar().setUnitIncrement(16);
		add(scrollPane, BorderLayout.CENTER);

	}

	private void preloadSprites()
	{
		for (SkillingOutfitData.SkillingOutfitDataEntry entry : SkillingOutfitData.OUTFITS_DATA.values())
			for (int itemId : entry.items.keySet())
				itemSprites.put(itemId, itemManager.getImage(itemId, 1, false));
	}

	public void setupOutfitDisplayMap()
	{
		for (var entry : SkillingOutfitData.OUTFITS_DATA.entrySet())
		{
			String outfitName = entry.getKey();
			String configKey = entry.getValue().configKey;
			outfitDisplayMap.put(outfitName, () -> {
				Object result = configManager.getConfiguration("skillingoutfit", configKey);
				return result != null && Boolean.parseBoolean(result.toString());
			});
		}
	}

	private void paintItems(Graphics2D g)
	{
		iconBounds.clear();
		hoverItemMap.clear();
		outfitBounds.clear();

		int panelWidth = getWidth();
		int yOffset = config.panelTitleSpacer();
		FontMetrics fm = g.getFontMetrics();

		// Title
		g.setColor(Color.WHITE);
		String title = "Skilling Outfit Tracker";
		g.drawString(title, (panelWidth - fm.stringWidth(title)) / 2, yOffset + fm.getAscent());
		yOffset += fm.getHeight();

		// Display outfit and item collected counts
		yOffset = paintCollectedCounts(g, panelWidth, yOffset, fm);

		Player localPlayer = client.getLocalPlayer();
		boolean isFemale = localPlayer != null && localPlayer.getPlayerComposition() != null && localPlayer.getPlayerComposition().isFemale();

		for (String outfitName : SkillingOutfitData.OUTFITS_DATA.keySet())
		{
			if (!shouldDisplayOutfit(outfitName)) continue;

			SkillingOutfitData.SkillingOutfitDataEntry entry = SkillingOutfitData.OUTFITS_DATA.get(outfitName);
			if (entry == null) continue;
			if (outfitName.equals("Farming - Farmer's Outfit Male") && isFemale) continue;
			if (outfitName.equals("Farming - Farmer's Outfit Female") && !isFemale) continue;

			yOffset = paintOutfit(entry, outfitName, g, panelWidth, yOffset, fm);
		}

		drawItemHoverTooltip(g);
		drawOutfitHoverTooltip(g);
	}

	private int paintCollectedCounts(Graphics2D g, int panelWidth, int yOffset, FontMetrics fm)
	{
		if (config.displayCollectedOutfits())
		{
			int ownedOutfits = (int) SkillingOutfitData.OUTFITS_DATA.values().stream()
					.filter(entry -> entry.items.values().stream().allMatch(item -> isItemOwnedCached(item.getItemId())))
					.count();
			int totalOutfits = SkillingOutfitData.OUTFITS_DATA.size();
			String text = "Collected: " + ownedOutfits + " / " + totalOutfits + " Outfits";
			g.setColor(getCollectedColor(ownedOutfits, totalOutfits));
			yOffset += config.outfitTextSpacer();
			g.drawString(text, (panelWidth - fm.stringWidth(text)) / 2, yOffset + fm.getAscent());
			yOffset += fm.getHeight();
		}

		if (config.displayCollectedItems())
		{
			int ownedItems = (int) SkillingOutfitData.OUTFITS_DATA.values().stream()
					.flatMap(entry -> entry.items.values().stream())
					.mapToInt(item -> isItemOwnedCached(item.getItemId()) ? 1 : 0)
					.sum();
			int totalItems = SkillingOutfitData.OUTFITS_DATA.values().stream().mapToInt(entry -> entry.items.size()).sum();
			String text = "Collected: " + ownedItems + " / " + totalItems + " Items";
			g.setColor(getCollectedColor(ownedItems, totalItems));
			yOffset += config.itemTextSpacer();
			g.drawString(text, (panelWidth - fm.stringWidth(text)) / 2, yOffset + fm.getAscent());
			yOffset += fm.getHeight();
		}
		return yOffset;
	}

	private int paintOutfit(SkillingOutfitData.SkillingOutfitDataEntry entry, String outfitName, Graphics2D g, int panelWidth, int yOffset, FontMetrics fm)
	{
		Map<Integer, SkillingOutfitItem> items = entry.items;
		boolean allObtained = items.values().stream().allMatch(item -> isItemOwnedCached(item.getItemId()));
		if (allObtained && !config.showObtainedItems()) return yOffset;

		// ----------------------------
		// Outfit title
		// ----------------------------
		yOffset += config.firstOutfitSpacer();
		// Determine outfit color (respecting override config)
		Color outfitColor;
		if (config.overrideOutfitColors())                   // Use the user's custom override color
		{
			outfitColor = config.outfitNameColor();
		}
		else                                                 // Use the default color based on primary skill (or fallback cyan)
		{
			outfitColor = (entry.primarySkill != null)
					? SKILL_COLORS.getOrDefault(entry.primarySkill, Color.CYAN)
					: Color.CYAN;
		}
		// Draw the outfit title
		g.setColor(outfitColor);
		int nameWidth = fm.stringWidth(outfitName);
		int outfitX = (panelWidth - nameWidth) / 2;
		g.drawString(outfitName, outfitX, yOffset + fm.getAscent());
		// Track hover bounds
		outfitBounds.put(outfitName, new Rectangle(outfitX, yOffset, nameWidth, fm.getHeight()));
		// Increment offset
		yOffset += fm.getHeight();

		// ----------------------------
		// Main points / cost line
		// ----------------------------
		yOffset += config.totalNeededTextSpacer();
		String pointsLine = buildPointsLine(entry, items);
		if (!pointsLine.isEmpty())
		{
			g.setColor(Color.LIGHT_GRAY);
			g.drawString(pointsLine, (panelWidth - fm.stringWidth(pointsLine)) / 2, yOffset + fm.getAscent());
			yOffset += fm.getHeight();
		}

		// ----------------------------
		// Icons
		// ----------------------------
		yOffset += config.iconTextSpacer();
		List<Map.Entry<Integer, SkillingOutfitItem>> itemList = items.entrySet().stream()
				.filter(e -> config.showObtainedItems() || !isItemOwnedCached(e.getKey()))
				.collect(Collectors.toList());

		int totalItems = itemList.size();
		int rows = (int) Math.ceil(totalItems / (double) config.maxCols());

		for (int row = 0; row < rows; row++)
		{
			int itemsInRow = Math.min(config.maxCols(), totalItems - row * config.maxCols());
			int rowWidth = itemsInRow * config.iconSize() + (itemsInRow - 1) * config.iconGapSpacing();
			int startX = (panelWidth - rowWidth) / 2;

			for (int col = 0; col < itemsInRow; col++)
			{
				int index = row * config.maxCols() + col;
				var entryItem = itemList.get(index);
				int itemId = entryItem.getKey();
				BufferedImage sprite = itemSprites.get(itemId);
				if (sprite == null) continue;

				int x = startX + col * (config.iconSize() + config.iconGapSpacing());
				int y = yOffset + row * (config.iconSize() + config.iconGapSpacing());
				g.drawImage(sprite, x, y, config.iconSize(), config.iconSize(), null);

				if (isItemOwnedCached(itemId) && config.showObtainedItems())
				{
					g.setColor(Color.GREEN);
					g.setStroke(new BasicStroke(2));
					g.drawRect(x, y, config.iconSize(), config.iconSize());
				}

				iconBounds.put(itemId, new Rectangle(x, y, config.iconSize(), config.iconSize()));
				hoverItemMap.put(itemId, entryItem.getValue());
			}
		}
		yOffset += rows * (config.iconSize() + config.iconGapSpacing());

		// ----------------------------
		// Extra costs (centered)
		// ----------------------------
		yOffset = drawOutfitExtraCosts(g, entry.items, panelWidth, yOffset);

		return yOffset;
	}

	// Updated buildPointsLine to only count remaining unowned items
	private String buildPointsLine(SkillingOutfitData.SkillingOutfitDataEntry entry, Map<Integer, SkillingOutfitItem> items)
	{
		if (!config.showTotalObtain()) return "";

		// Only hide the line if the WHOLE SET is obtained
		boolean fullSetOwned = items.values().stream()
				.allMatch(i -> isItemOwnedCached(i.getItemId()));
		if (fullSetOwned)
		{
			return "";
		}

		int totalRequired = items.values().stream()
				.filter(i -> !isItemOwnedCached(i.getItemId()))
				.mapToInt(SkillingOutfitItem::getRequirement)
				.sum();

		int costItemId = items.values().stream()
				.filter(i -> !isItemOwnedCached(i.getItemId()))
				.mapToInt(SkillingOutfitItem::getCostItemId)
				.findFirst().orElse(-1);
		String costText = items.values().stream()
				.filter(i -> !isItemOwnedCached(i.getItemId()))
				.map(SkillingOutfitItem::getCostText)
				.findFirst().orElse("");

		int totalAvailable = (costItemId != -1)
				? tracker.getTotalCostItem(costItemId)
				: 0;

		switch (entry.primarySkill)
		{
			case "Construction": return tracker.getCarpenterPoints() + "/" + totalRequired + " Carpenter Points Owned";
			case "Farming": return tracker.getTitheFarmPoints() + "/" + totalRequired + " Farming Points Owned";
			case "Smithing": return tracker.getFoundryReputation() + "/" + totalRequired + " Reputation Owned";
			case "Firemaking": return tracker.getWintertodtCrates() + " Wintertodt Subdued";
			case "Fishing": return tracker.getTemporossPoints() + " Tempoross Kills";
			case "Hunter": return tracker.getHunterRumors() + " Hunter Rumors Completed";
			case "Prayer": return "Shade Catacombs - Gold Chest";
			case "Agility": return totalAvailable + "/" + totalRequired + " " + costText + " Owned";
			case "Woodcutting": return tracker.getAnimaBark() + "/" + totalRequired + " " + costText + " Owned";
			case "Thieving": return tracker.getRoguesDenAttempts() + " Safes Opened";
			default: return totalAvailable + "/" + totalRequired + " " + costText + " Owned";
		}
	}

	private int sumRequirements(Map<Integer, SkillingOutfitItem> items)
	{
		return items.values().stream()
				.filter(item -> !isItemOwnedCached(item.getItemId())) // only count unowned items
				.mapToInt(SkillingOutfitItem::getRequirement)
				.sum();
	}

	private boolean shouldDisplayOutfit(String outfitName)
	{
		BooleanSupplier supplier = outfitDisplayMap.get(outfitName);
		return supplier != null && supplier.getAsBoolean();
	}

	private Color getCollectedColor(long owned, long total)
	{
		if (!config.colorTextForCollected()) return Color.WHITE;
		double percent = total == 0 ? 0 : (owned * 100.0 / total);
		if (percent <= 33) return Color.RED;
		else if (percent <= 65) return Color.ORANGE;
		else if (percent < 100) return Color.YELLOW;
		else return Color.GREEN;
	}

	private int getItemAt(int x, int y)
	{
		for (var entry : iconBounds.entrySet())
			if (entry.getValue().contains(x, y)) return entry.getKey();
		return -1;
	}

	private String getOutfitAt(int x, int y)
	{
		for (var entry : outfitBounds.entrySet())
			if (entry.getValue().contains(x, y)) return entry.getKey();
		return null;
	}

	private boolean isItemOwnedCached(int itemId)
	{
		// First, find the SkillingOutfitItem for this ID
		SkillingOutfitItem outfitItem = null;
		outer:
		for (var entry : SkillingOutfitData.OUTFITS_DATA.values())
			for (SkillingOutfitItem i : entry.items.values())
				if (i.getItemId() == itemId)
				{
					outfitItem = i;
					break outer;
				}

		// If we have an outfitItem, check both main ID and otherItemIds
		if (outfitItem != null)
		{
			// Combine main ID + other IDs into one stream
			List<Integer> allIds = new ArrayList<>();
			allIds.add(outfitItem.getItemId());
			allIds.addAll(outfitItem.getOtherItemIds());

			for (int id : allIds)
			{
				if (tracker.getObtainedItems().contains(id)) return true;

				int inv = inventoryCacheSnapshot.getOrDefault(id, 0);
				int equip = equipmentCacheSnapshot.getOrDefault(id, 0);
				int bank = bankCacheSnapshot.getOrDefault(id, 0);
				if ((inv + equip + bank) > 0) return true;
			}

			return false;
		}

		// fallback: check only tracker and caches for the single ID
		if (tracker.getObtainedItems().contains(itemId)) return true;
		int inv = inventoryCacheSnapshot.getOrDefault(itemId, 0);
		int equip = equipmentCacheSnapshot.getOrDefault(itemId, 0);
		int bank = bankCacheSnapshot.getOrDefault(itemId, 0);
		return (inv + equip + bank) > 0;
	}


	public void updateAllCaches()
	{
		clientThread.invoke(() -> {
			tracker.updateAllCaches();
			inventoryCacheSnapshot.clear(); inventoryCacheSnapshot.putAll(tracker.getInventoryCacheSnapshot());
			equipmentCacheSnapshot.clear(); equipmentCacheSnapshot.putAll(tracker.getEquipmentCacheSnapshot());
			bankCacheSnapshot.clear(); bankCacheSnapshot.putAll(tracker.getBankCacheSnapshot());
			SwingUtilities.invokeLater(innerPanel::repaint);
		});
	}

	public int getSnapshotTotalCostItem(int itemId)
	{
		return inventoryCacheSnapshot.getOrDefault(itemId, 0)
				+ equipmentCacheSnapshot.getOrDefault(itemId, 0)
				+ bankCacheSnapshot.getOrDefault(itemId, 0);
	}

	private Dimension calculatePreferredSize()
	{
		int width = 300;
		int height = config.panelTitleSpacer();
		FontMetrics fm = getFontMetrics(getFont());

		if (config.displayCollectedOutfits())
			height += config.outfitTextSpacer() + fm.getHeight();
		if (config.displayCollectedItems())
			height += config.itemTextSpacer() + fm.getHeight();

		for (String outfitName : SkillingOutfitData.OUTFITS_DATA.keySet())
		{
			if (!shouldDisplayOutfit(outfitName)) continue;
			SkillingOutfitData.SkillingOutfitDataEntry entry = SkillingOutfitData.OUTFITS_DATA.get(outfitName);
			if (entry == null) continue;

			height += config.firstOutfitSpacer() + fm.getHeight();               // title
			height += config.totalNeededTextSpacer() + fm.getHeight();           // points line
			height += config.iconTextSpacer();                                   // spacing before icons

			int rows = (int) Math.ceil(entry.items.size() / (double) config.maxCols());
			height += rows * (config.iconSize() + config.iconGapSpacing());      // icons

			// --- Extra costs per item ---
			for (SkillingOutfitItem item : entry.items.values())
			{
				List<SkillingOutfitItem.CostEntry> extra = SkillingOutfitData.EXTRA_COSTS.get(item.getItemId());
				if (extra != null && !extra.isEmpty())
				{
					height += 10; // spacing before header (matches drawOutfitExtraCosts)
					height += fm.getHeight(); // header line
					height += fm.getHeight() * extra.size(); // each extra resource line
					height += 6; // spacing after each item
				}
			}
		}

		// add small bottom buffer
		height += 80;

		return new Dimension(width, height);
	}



	public void refresh()
	{
		setupOutfitDisplayMap();
		if (innerPanel != null)
		{
			innerPanel.revalidate();
			innerPanel.repaint();
		}
	}

	private void drawItemHoverTooltip(Graphics2D g)
	{
		if (hoveredItemId == -1) return;

		Rectangle iconRect = iconBounds.get(hoveredItemId);
		SkillingOutfitItem item = hoverItemMap.get(hoveredItemId);
		if (iconRect == null || item == null) return;

		List<String> tooltipLines = new ArrayList<>();
		tooltipLines.add(item.getName());

		StringBuilder requirementLine = new StringBuilder();
		int requirement = item.getRequirement();
		String costText = item.getCostText();

		if (requirement > 0)
		{
			requirementLine.append(requirement);
		}

		if (costText != null && !costText.isEmpty())
		{
			if (requirementLine.length() > 0) requirementLine.append(" ");
			requirementLine.append(costText);
		}

		if (requirementLine.length() > 0)
		{
			tooltipLines.add(requirementLine.toString());
		}

		tooltipLines.add("Click To Open Wiki");

		drawTooltip(g, iconRect, tooltipLines);
	}

	private void drawOutfitHoverTooltip(Graphics2D g)
	{
		if (hoveredOutfitName == null) return;
		Rectangle outfitRect = outfitBounds.get(hoveredOutfitName);
		if (outfitRect == null) return;

		SkillingOutfitData.SkillingOutfitDataEntry entry = SkillingOutfitData.OUTFITS_DATA.get(hoveredOutfitName);
		if (entry == null) return;

		int owned = (int) entry.items.values().stream().filter(i -> isItemOwnedCached(i.getItemId())).count();
		int total = entry.items.size();
		int totalRequired = entry.items.values().stream().filter(i -> !isItemOwnedCached(i.getItemId())).mapToInt(SkillingOutfitItem::getRequirement).sum();
		int costItemId = entry.items.values().stream().filter(i -> !isItemOwnedCached(i.getItemId())).mapToInt(SkillingOutfitItem::getCostItemId).findFirst().orElse(-1);
		int costAvailable = getSnapshotTotalCostItem(costItemId);
		String costText = entry.items.values().stream().filter(i -> !isItemOwnedCached(i.getItemId())).map(SkillingOutfitItem::getCostText).findFirst().orElse("");

		List<String> lines = new ArrayList<>();
		lines.add("Owned: " + owned + "/" + total + " Items");
		if (totalRequired > 0) lines.add(costAvailable + "/" + totalRequired + " " + costText + " Owned");
		lines.add("Click To Open Wiki");

		drawTooltip(g, outfitRect, lines);
	}

	private void drawTooltip(Graphics2D g, Rectangle rect, List<String> lines)
	{
		FontMetrics fm = g.getFontMetrics();
		int padding = 4;
		int overlayWidth = lines.stream().mapToInt(fm::stringWidth).max().orElse(0) + padding * 2;
		int overlayHeight = lines.size() * fm.getHeight() + padding * 4;

		int x = (getWidth() - overlayWidth) / 2;
		int y = rect.y + rect.height + 5;

		g.setColor(new Color(0, 0, 0, 220));
		g.fillRect(x, y, overlayWidth, overlayHeight);
		g.setColor(Color.WHITE);
		g.drawRect(x, y, overlayWidth, overlayHeight);

		for (int i = 0; i < lines.size(); i++)
			g.drawString(lines.get(i), x + (overlayWidth - fm.stringWidth(lines.get(i))) / 2, y + padding + i * fm.getHeight() + fm.getAscent());
	}

	private void openWikiLink(String url)
	{
		try
		{
			url = url.replace(" ", "_");
			Desktop.getDesktop().browse(URI.create(url));
		}
		catch (Exception e)
		{
			try
			{
				// Fallback: Encode manually
				String encoded = java.net.URLEncoder.encode(url, StandardCharsets.UTF_8);
				Desktop.getDesktop().browse(URI.create(encoded));
			}
			catch (Exception ex)
			{

			}
		}
	}

	// Updated drawOutfitExtraCosts
	private int drawOutfitExtraCosts(Graphics2D g, Map<Integer, SkillingOutfitItem> items, int panelWidth, int startY)
	{
		// Skip entirely if the user disabled "Show Price To Obtain"
		if (!config.showTotalObtain() || !config.showItemTotalObtain())
		{
			return startY;
		}

		int y = startY;
		y += 10; // spacing before totals
		FontMetrics fm = g.getFontMetrics();

		for (SkillingOutfitItem item : items.values())
		{
			List<SkillingOutfitItem.CostEntry> extra = SkillingOutfitData.EXTRA_COSTS.get(item.getItemId());
			if (extra == null || extra.isEmpty())
				continue;

			// ✅ Skip if player already owns this outfit item
			if (tracker.getObtainedItems().contains(item.getItemId()))
			{
				continue;
			}

			// ---- Check if all extra costs are already met ----
			boolean allObtained = true;
			for (SkillingOutfitItem.CostEntry e : extra)
			{
				int owned = (e.getItemId() == 28134)
						? config.animaBark()
						: tracker.getTotalCostItem(e.getItemId());
				if (owned < e.getAmount())
				{
					allObtained = false;
					break;
				}
			}

			// ✅ Skip if all costs are satisfied
			if (allObtained)
				continue;

			// ---- Determine primary skill for this item ----
			String primarySkill = null;
			for (SkillingOutfitData.SkillingOutfitDataEntry entry : SkillingOutfitData.OUTFITS_DATA.values())
			{
				if (entry.items.containsKey(item.getItemId()))
				{
					primarySkill = entry.primarySkill;
					break;
				}
			}

			// ---- Determine header color ----
			Color headerColor = config.overrideOutfitColors()
					? config.outfitNameColor()
					: (primarySkill != null
					? SKILL_COLORS.getOrDefault(primarySkill, new Color(180, 200, 255))
					: new Color(180, 200, 255));

			// ---- Draw header ----
			String header = item.getName() + " Total Cost";
			int headerX = (panelWidth - fm.stringWidth(header)) / 2;
			g.setColor(headerColor);
			g.drawString(header, headerX, y);
			y += fm.getHeight();

			// ---- Draw resource lines ----
			g.setColor(Color.LIGHT_GRAY);
			for (SkillingOutfitItem.CostEntry e : extra)
			{
				int owned = (e.getItemId() == 28134)
						? config.animaBark()
						: tracker.getTotalCostItem(e.getItemId());
				String line = String.format("%,d/%d %s", owned, e.getAmount(), e.getItemName());
				int lineX = (panelWidth - fm.stringWidth(line)) / 2;
				g.drawString(line, lineX, y);
				y += fm.getHeight();
			}

			y += 6; // spacing between items
		}

		return y;
	}

}

package com.gimsieder.skillingoutfit;

import com.google.inject.Provides;
import lombok.extern.slf4j.Slf4j;
import net.runelite.api.*;
import net.runelite.api.events.*;
import net.runelite.api.widgets.Widget;
import net.runelite.client.callback.ClientThread;
import net.runelite.client.chat.ChatMessageBuilder;
import net.runelite.client.chat.ChatMessageManager;
import net.runelite.api.ChatMessageType;
import net.runelite.client.chat.QueuedMessage;
import net.runelite.client.config.ConfigManager;
import net.runelite.client.eventbus.EventBus;
import net.runelite.client.eventbus.Subscribe;
import net.runelite.client.events.ConfigChanged;
import net.runelite.client.game.ItemManager;
import net.runelite.client.plugins.Plugin;
import net.runelite.client.plugins.PluginDescriptor;
import net.runelite.client.ui.ClientToolbar;
import net.runelite.client.ui.NavigationButton;

import javax.inject.Inject;
import javax.swing.*;
import java.awt.*;
import java.awt.image.BufferedImage;
import java.util.HashSet;
import java.util.Set;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import java.util.function.Consumer;

@PluginDescriptor(
		name = "Skilling Outfit Tracker",
		description = "Tracks skilling outfits obtained (inventory, bank, or equipped)",
		tags = {"skilling", "outfit", "tracking"}
)
@Slf4j
public class SkillingOutfitPlugin extends Plugin
{
	@Inject private Client client;
	@Inject private SkillingOutfitTracker tracker;
	@Inject private ItemManager itemManager;
	@Inject private ClientToolbar clientToolbar;
	@Inject private ClientThread clientThread;
	@Inject private ChatMessageManager chatMessageManager;
	@Inject private SkillingOutfitConfig config;
	@Inject private ConfigManager configManager;
	@Inject private EventBus eventBus;

	private NavigationButton navButton;
	private SkillingOutfitWindow popoutWindow;
	private SkillingOutfitPanel panel;
	private final String configGroup = "skillingoutfit";

	// ===== Patterns for minigame tracking =====
	private static final Pattern CONTRACT_PATTERN = Pattern.compile(
			"You have completed <col=[0-9a-f]+>(\\d+)</col> contracts with a total of <col=[0-9a-f]+>(\\d+)</col> points\\."
	);
	// Farming Not Completed
	private static final Pattern TITHE_FARM_PATTERN = Pattern.compile(
			"You now have <col=[0-9a-f]+>(\\d+)</col> reward points\\."
	);
	private static final Pattern TEMPOROSS_PATTERN = Pattern.compile(
			"Your Tempoross kill count is: <col=[0-9a-f]+>(\\d+)</col>\\."
	);
	private static final Pattern HUNTER_PATTERN = Pattern.compile(
			"You have completed <col=[0-9a-fA-F]+>(\\d+)</col> rumours for the Hunter Guild\\."
	);
	private static final Pattern WINTERTODT_PATTERN = Pattern.compile(
			"Your subdued Wintertodt count is: <col=[0-9a-f]+>(\\d+)</col>\\."
	);
	private static final Pattern ANIMA_BARK_PATTERN = Pattern.compile(
			"You've been awarded\\s*(?:<col=[0-9A-Fa-f]+>)?([\\d,]+)\\s*Anima-infused bark(?:</col>)?\\.?"
	);
	private static final Pattern ROGUES_DEN = Pattern.compile(
			"You start cracking the safe\\."
	);

		// ===== Startup =====
	@Override
	protected void startUp()
	{
		panel = new SkillingOutfitPanel(client, itemManager, tracker, config, configManager, this, clientThread);

		configManager.setConfiguration("skillingoutfit", "enablePopoutConfigMode", "false");

		// FIX: Load icon on client thread AFTER cache is ready
		clientThread.invokeLater(() ->
		{
			BufferedImage icon = itemManager.getImage(22327);

			navButton = NavigationButton.builder()
					.tooltip("Skilling Outfit Tracker")
					.icon(icon)
					.panel(panel)
					.priority(10)
					.build();

			clientToolbar.addNavigation(navButton);
		});

		// Keep the rest of your startup logic exactly the same
		clientThread.invokeLater(() ->
		{
			tracker.loadObtainedItems();
			tracker.loadBankCache();
			tracker.updateInventoryCache();
			tracker.updateEquipmentCache();
			tracker.updateBankCache();

			clientThread.invokeLater(() ->
			{
				tracker.updateOwnedItemsFromCaches();
				tracker.updateOwnedItems();
				tracker.saveObtainedItems();
				safeUpdatePanel(panel::updateAllCaches);
			});
		});

		loadMinigameStat("mahoganyContracts", tracker::setCarpenterContracts, 0);
		loadMinigameStat("mahoganyPoints", tracker::setCarpenterPoints, 0);
		loadMinigameStat("farmingPoints", tracker::setFarmingPoints, 0);
		loadMinigameStat("temporossPoints", tracker::setTemporossPoints, 0);
		loadMinigameStat("hunterRumors", tracker::setHunterRumors, 0);
		loadMinigameStat("wintertodtCrates", tracker::setWintertodtCrates, 0);
		loadMinigameStat("animaBark", tracker::setAnimaBark, 0);
		loadMinigameStat("roguesDenAttempts", tracker::setRoguesDenAttempts, 0);
	}

	// ===== Shutdown =====
	@Override
	protected void shutDown()
	{
		if (navButton != null) clientToolbar.removeNavigation(navButton);
		if (popoutWindow != null)
		{
			popoutWindow.dispose();
			popoutWindow = null;
		}
	}

	// ===== Chat Message Parsing =====
	@Subscribe
	public void onChatMessage(ChatMessage event)
	{
		ChatMessageType type = event.getType();
		if (type != ChatMessageType.GAMEMESSAGE && type != ChatMessageType.SPAM)
		{
			return;
		}

		String message = event.getMessage();

		// Mahogany Homes
		if (handleTwoValueMessage(CONTRACT_PATTERN, message,
				(contracts, points) -> {
					tracker.setCarpenterContracts(contracts);
					tracker.setCarpenterPoints(points);
					persistConfig("mahoganyContracts", contracts);
					persistConfig("mahoganyPoints", points);
				})) return;

		// Single-value minigames
		if (handleSingleValueMessage(TITHE_FARM_PATTERN, message, tracker::setFarmingPoints, "farmingPoints")) return;
		if (handleSingleValueMessage(TEMPOROSS_PATTERN, message, tracker::setTemporossPoints, "temporossPoints")) return;
		if (handleSingleValueMessage(HUNTER_PATTERN, message, tracker::setHunterRumors, "hunterRumors")) return;

		// Wintertodt
		if (handleSingleValueMessage(WINTERTODT_PATTERN, message, crates -> {
			if (crates > tracker.getWintertodtCrates()) {
				tracker.setWintertodtCrates(crates);
				persistConfig("wintertodtCrates", crates);
				safeUpdatePanel(panel::updateAllCaches);
			}
		}, null)) return;

		// Anima-Infused Bark
		if (handleSingleValueMessage(ANIMA_BARK_PATTERN, message, bark -> {
			int newTotal = tracker.getAnimaBark() + bark;
			tracker.setAnimaBark(newTotal);
			persistConfig("animaBark", newTotal);
			safeUpdatePanel(panel::updateAllCaches);

			// Print to in-game chat
			client.addChatMessage(ChatMessageType.GAMEMESSAGE, "[SOT]", "Added " + bark + " Anima Bark To Total", null);
		}, null)) return;

		// Rogues' Den - Safe Attempts
		Matcher rogue = ROGUES_DEN.matcher(message);
		if (rogue.find())
		{
			int newValue = tracker.getRoguesDenAttempts() + 1;
			tracker.setRoguesDenAttempts(newValue);
			persistConfig("roguesDenAttempts", newValue);

			safeUpdatePanel(panel::updateAllCaches);
			return;
		}
	}

	// ===== Item Container Changes =====
	@Subscribe
	public void onItemContainerChanged(ItemContainerChanged event)
	{
		int id = event.getContainerId();
		if (id == InventoryID.INVENTORY.getId()
				|| id == InventoryID.EQUIPMENT.getId()
				|| id == InventoryID.BANK.getId())
		{
			safeUpdatePanel(() -> {
				tracker.updateAllCaches();
				panel.updateAllCaches();
				tracker.updateOwnedItemsFromCaches();
			});
		}
	}

	@Subscribe
	public void onVarbitChanged(VarbitChanged event)
	{
		int varbitId = event.getVarbitId();
		int varpId = event.getVarpId();

		// Foundry Rep — varp
		if (varpId == tracker.FOUNDRY_REPUTATION)
		{
			tracker.foundryReputation = client.getVarpValue(tracker.FOUNDRY_REPUTATION);
		}

		// Tithe Farm Points — varbit
		else if (varbitId == tracker.FARMING_POINTS)
		{
			int points = client.getVarbitValue(tracker.FARMING_POINTS);
			tracker.titheFarmPoints = points;
		}
	}

	// ===== Game State Changes =====
	@Subscribe
	public void onGameStateChanged(GameStateChanged event)
	{
		if (event.getGameState() == GameState.LOGGED_IN)
		{
			// 1. Update all live caches
			tracker.updateInventoryCache();
			tracker.updateEquipmentCache();
			tracker.updateBankCache();
			tracker.updateOwnedItems();

			// 2. Refresh cost item cache based on actual snapshots
			tracker.refreshCostItemCache();

			// 3. Update panel safely
			clientThread.invoke(() -> {
				panel.updateAllCaches();  // updates snapshots and repaints innerPanel
				panel.refresh();          // ensures outfit display map is up-to-date
				tracker.foundryReputation = client.getVarpValue(tracker.FOUNDRY_REPUTATION);
			});
		}
	}


	// ===== Config Changed =====
	@Subscribe
	public void onConfigChanged(ConfigChanged event)
	{
		if (!"skillingoutfit".equals(event.getGroup())) return;

		SwingUtilities.invokeLater(() -> {
			switch (event.getKey())
			{
				case "enablePopoutConfigMode":
					if (config.enablePopoutConfigMode()) {
						if (popoutWindow == null || !popoutWindow.isDisplayable())
							popoutWindow = new SkillingOutfitWindow(config, panel, configManager, eventBus, clientThread);
					} else if (popoutWindow != null) {
						popoutWindow.dispose();
						popoutWindow = null;
					}
					break;

				case "animaBark":
					if (panel != null)
					{
						tracker.setAnimaBark(config.animaBark());
						panel.refresh();
					}
					break;

				default:
					if (event.getKey().startsWith("display") && panel != null)
						panel.setupOutfitDisplayMap();
			}
			safeUpdatePanel(panel::refresh);
		});
	}

	// ===== Config Provider =====
	@Provides
	SkillingOutfitConfig provideConfig(ConfigManager configManager)
	{
		return configManager.getConfig(SkillingOutfitConfig.class);
	}

	// ===== Helper Methods =====
	private void safeUpdatePanel(Runnable r)
	{
		if (panel != null) r.run();
	}

	private void persistConfig(String key, int value)
	{
		if (key != null) configManager.setConfiguration("skillingoutfit", key, value);
		safeUpdatePanel(panel::updateAllCaches);
	}

	private void loadMinigameStat(String key, Consumer<Integer> setter, int defaultValue)
	{
		Integer stored = configManager.getConfiguration("skillingoutfit", key, Integer.class);
		setter.accept((stored != null) ? stored : defaultValue);
	}

	private BufferedImage resizeIcon(BufferedImage icon, int width, int height)
	{
		if (icon == null) return null;
		if (icon.getWidth() == width && icon.getHeight() == height) return icon;

		BufferedImage resized = new BufferedImage(width, height, BufferedImage.TYPE_INT_ARGB);
		Graphics2D g2d = resized.createGraphics();
		g2d.drawImage(icon, 0, 0, width, height, null);
		g2d.dispose();
		return resized;
	}

	private boolean handleTwoValueMessage(Pattern pattern, String message, java.util.function.BiConsumer<Integer, Integer> handler)
	{
		Matcher matcher = pattern.matcher(message);
		if (matcher.find() && matcher.groupCount() >= 2)
		{
			handler.accept(Integer.parseInt(matcher.group(1)), Integer.parseInt(matcher.group(2)));
			return true;
		}
		return false;
	}

	private boolean handleSingleValueMessage(Pattern pattern, String message, Consumer<Integer> setter, String configKey)
	{
		Matcher matcher = pattern.matcher(message);
		if (matcher.find())
		{
			int value = Integer.parseInt(matcher.group(1));
			setter.accept(value);
			if (configKey != null) persistConfig(configKey, value);
			safeUpdatePanel(panel::updateAllCaches);
			return true;
		}
		return false;
	}
}





package com.gimsieder.skillingoutfit;

import lombok.Getter;
import lombok.Setter;
import net.runelite.api.Client;
import net.runelite.api.Item;
import net.runelite.api.ItemContainer;
import net.runelite.api.InventoryID;
import net.runelite.api.events.VarbitChanged;
import net.runelite.client.callback.ClientThread;
import net.runelite.client.config.ConfigManager;
import net.runelite.api.ChatMessageType;
import net.runelite.client.game.ItemManager;

import javax.inject.Inject;
import javax.swing.*;
import java.awt.*;
import java.util.*;

@Getter
@Setter
public class SkillingOutfitTracker
{
	private int carpenterPoints = 0;
	private int carpenterContracts = 0;
	private int farmingPoints = 0;
	private int temporossPoints = 0;
	private int hunterRumors = 0;
	private int wintertodtCrates = 0;
	private int animaBark;
	private int roguesDenAttempts = 0;

	private final Map<Integer, Boolean> ownedCache = new HashMap<>();
	private final Set<Integer> obtainedItems = new HashSet<>();
	private final Map<Integer, Integer> inventoryCostCache = new HashMap<>();
	private final Map<Integer, Integer> equipmentCostCache = new HashMap<>();
	private final Map<Integer, Integer> bankCostCache = new HashMap<>();

	private final Client client;
	private final ClientThread clientThread;
	private final ConfigManager configManager;
	private final String configGroup = "skillingoutfit";
	private final SkillingOutfitConfig config;
	private final ItemManager itemManager;

	private Map<Integer, Integer> inventoryCacheSnapshot = new HashMap<>();
	private Map<Integer, Integer> equipmentCacheSnapshot = new HashMap<>();
	private Map<Integer, Integer> bankCacheSnapshot = new HashMap<>();

	@Setter
	private SkillingOutfitPanel panel;

	@Inject
	public SkillingOutfitTracker(Client client, ClientThread clientThread, ConfigManager configManager, SkillingOutfitConfig config, ItemManager itemManager)
	{
		this.client = client;
		this.clientThread = clientThread;
		this.configManager = configManager;
		this.config = config;
		this.itemManager = itemManager;

		loadObtainedItems();
		loadBankCache();
	}

	// ======== UPDATE ALL CACHES ========
	public void updateAllCaches() {
		updateInventoryCache();
		updateEquipmentCache();
		updateBankCache();
	}

	public void updateInventoryCache()
	{
		// Clear previous cache
		inventoryCostCache.clear();

		// Ensure this runs on the client thread
		clientThread.invoke(() ->
		{
			ItemContainer inv = client.getItemContainer(InventoryID.INVENTORY);
			if (inv != null)
			{
				for (Item item : inv.getItems())
				{
					int id = item.getId();
					int qty = item.getQuantity();
					inventoryCostCache.put(id, qty);
				}
			}
			// Update snapshot for safe panel/thread reading
			inventoryCacheSnapshot = new HashMap<>(inventoryCostCache);
		});
	}

	public void updateEquipmentCache()
	{
		equipmentCostCache.clear();

		ItemContainer equipment = client.getItemContainer(InventoryID.EQUIPMENT);
		if (equipment != null)
		{
			for (Item item : equipment.getItems())
			{
				equipmentCostCache.put(item.getId(), item.getQuantity());
			}
		}

		equipmentCacheSnapshot = new HashMap<>(equipmentCostCache);
	}

	public void updateBankCache()
	{
		ItemContainer bank = client.getItemContainer(InventoryID.BANK);
		if (bank != null)
		{
			Map<Integer, Integer> newBankSnapshot = new HashMap<>();
			for (Item item : bank.getItems())
				newBankSnapshot.put(item.getId(), item.getQuantity());

			bankCacheSnapshot = newBankSnapshot;

			// Save to config immediately
			saveBankCache();
		}
	}

	public void saveBankCache()
	{
		if (bankCacheSnapshot.isEmpty())
			return;

		StringBuilder sb = new StringBuilder();
		for (Map.Entry<Integer, Integer> entry : bankCacheSnapshot.entrySet())
		{
			sb.append(entry.getKey()).append(":").append(entry.getValue()).append(",");
		}
		if (sb.length() > 0)
			sb.setLength(sb.length() - 1); // remove trailing comma

		configManager.setConfiguration(configGroup, "bankCache", sb.toString());
	}

	public void loadBankCache()
	{
		String saved = configManager.getConfiguration(configGroup, "bankCache");
		if (saved == null || saved.isEmpty())
			return;

		Map<Integer, Integer> loaded = new HashMap<>();
		for (String pair : saved.split(","))
		{
			String[] parts = pair.split(":");
			if (parts.length != 2)
				continue;
			try
			{
				int itemId = Integer.parseInt(parts[0]);
				int qty = Integer.parseInt(parts[1]);
				loaded.put(itemId, qty);
			}
			catch (NumberFormatException ignored) {}
		}

		bankCacheSnapshot = loaded;
	}

	// ======== TOTAL COST ITEMS COMBINED ========
	public int getTotalCostItem(int costId)
	{
		int inv = inventoryCacheSnapshot.getOrDefault(costId, 0);
		int equip = equipmentCacheSnapshot.getOrDefault(costId, 0);
		int bank = bankCacheSnapshot.getOrDefault(costId, 0);

		return inv + equip + bank;
	}


	// ======== OWNED ITEM CHECKS ========
	private boolean isItemOwnedCached(int itemId)
	{
		int invCount = getInventoryCacheSnapshot().getOrDefault(itemId, 0);
		int equipCount = getEquipmentCacheSnapshot().getOrDefault(itemId, 0);
		int bankCount = getBankCacheSnapshot().getOrDefault(itemId, 0);

		return (invCount + equipCount + bankCount) > 0;
	}

	public void updateOwnedItems()
	{
		for (SkillingOutfitData.SkillingOutfitDataEntry outfitEntry : SkillingOutfitData.OUTFITS_DATA.values())
		{
			for (SkillingOutfitItem item : outfitEntry.items.values())
			{
				boolean owned = getTotalCostItem(item.getItemId()) > 0; // use combined total
				ownedCache.put(item.getItemId(), owned);
			}
		}
	}

	// ======== OBTAINED ITEMS ========
	public void saveObtainedItems()
	{
		StringBuilder sb = new StringBuilder();
		for (int id : obtainedItems)
			sb.append(id).append(",");
		if (sb.length() > 0)
			sb.setLength(sb.length() - 1);

		configManager.setConfiguration(configGroup, "obtainedItems", sb.toString());
	}

	public void loadObtainedItems()
	{
		String saved = configManager.getConfiguration(configGroup, "obtainedItems");
		if (saved != null && !saved.isEmpty())
		{
			for (String s : saved.split(","))
			{
				try
				{
					int itemId = Integer.parseInt(s);
					obtainedItems.add(itemId);
				}
				catch (NumberFormatException ignored) {}
			}
		}
	}

	public void updateOwnedItemsFromCaches()
	{
		ownedCache.clear();

		// Combine tracked item sources
		Set<Integer> allTrackedItems = new HashSet<>();
		allTrackedItems.addAll(inventoryCacheSnapshot.keySet());
		allTrackedItems.addAll(bankCacheSnapshot.keySet());

		// Include equipped items
		ItemContainer equipmentContainer = client.getItemContainer(InventoryID.EQUIPMENT);
		if (equipmentContainer != null)
		{
			for (Item item : equipmentContainer.getItems())
			{
				if (item != null && item.getId() > 0)
				{
					allTrackedItems.add(item.getId());
				}
			}
		}

		// Track owned items
		for (int itemId : allTrackedItems)
		{
			boolean isInInventory = inventoryCacheSnapshot.getOrDefault(itemId, 0) > 0;
			boolean isInBank = bankCacheSnapshot.getOrDefault(itemId, 0) > 0;
			boolean isInEquipment = (equipmentContainer != null &&
					Arrays.stream(equipmentContainer.getItems())
							.anyMatch(i -> i != null && i.getId() == itemId));

			boolean isOwned = isInInventory || isInBank || isInEquipment;
			boolean wasOwnedBefore = ownedCache.getOrDefault(itemId, false);

			ownedCache.put(itemId, isOwned);

			// Only trigger notification if it's truly new — not being moved or loaded from equipment
			if (isOwned && !obtainedItems.contains(itemId))
			{
				obtainedItems.add(itemId);

				if (!wasOwnedBefore)
				{
					// Skip notification if the item is ONLY in equipment (login equip load)
					if (isInEquipment && !isInInventory && !isInBank)
					{
						continue; // Skip this one entirely
					}

					// Find outfit + item name
					String outfitName = null;
					String itemName = null;

					for (Map.Entry<String, SkillingOutfitData.SkillingOutfitDataEntry> entry : SkillingOutfitData.OUTFITS_DATA.entrySet())
					{
						SkillingOutfitData.SkillingOutfitDataEntry outfitEntry = entry.getValue();
						Map<Integer, SkillingOutfitItem> items = outfitEntry.items;

						if (items.containsKey(itemId))
						{
							outfitName = entry.getKey();
							itemName = items.get(itemId).getName();
							break;
						}
					}
				}
			}
		}

		// Remove items that are no longer owned (dropped, sold, etc.)
		obtainedItems.removeIf(id -> !ownedCache.getOrDefault(id, false));

		saveObtainedItems();
		refreshCostItemCache();

		if (panel != null)
		{
			SwingUtilities.invokeLater(() -> panel.updateAllCaches());
		}
	}


	public void markObtainedFromConfig()
	{
		// Load items saved in config
		loadObtainedItems();

		// Add all previously obtained items to ownedCache so UI knows you own them
		for (int itemId : obtainedItems)
		{
			ownedCache.put(itemId, true);
		}
	}


	// ======== COST ITEM CACHE ========
	private final Map<Integer, Integer> costItemCache = new HashMap<>();

	private int loadCostItem(int costItemId)
	{
		Integer stored = configManager.getRSProfileConfiguration(configGroup, "costItem_" + costItemId, Integer.class);
		return (stored != null) ? stored : 0;
	}

	public void loadAllCostItems()
	{
		for (SkillingOutfitData.SkillingOutfitDataEntry outfitEntry : SkillingOutfitData.OUTFITS_DATA.values())
		{
			for (SkillingOutfitItem item : outfitEntry.items.values())
			{
				int costId = item.getCostItemId();
				costItemCache.put(costId, loadCostItem(costId));
			}
		}
	}

	public void refreshCostItemCache()
	{
		costItemCache.clear();

		for (SkillingOutfitData.SkillingOutfitDataEntry outfitEntry : SkillingOutfitData.OUTFITS_DATA.values())
		{
			for (SkillingOutfitItem item : outfitEntry.items.values())
			{
				int costId = item.getCostItemId();
				int total = getTotalCostItem(costId); // inventory+equipment+bank
				costItemCache.put(costId, total);
			}
		}
	}

	public static final int FOUNDRY_REPUTATION = 3436;
	public int foundryReputation = 0;
	public static final int FARMING_POINTS = 4893;
	public int titheFarmPoints = 0;

}


package com.gimsieder.skillingoutfit;

import net.runelite.client.callback.ClientThread;
import net.runelite.client.config.ConfigManager;
import net.runelite.client.eventbus.EventBus;
import net.runelite.client.events.ConfigChanged;

import javax.swing.*;
import java.awt.*;
import java.util.LinkedHashMap;
import java.util.Map;

public class SkillingOutfitWindow extends JFrame
{
	private final SkillingOutfitConfig config;
	private final SkillingOutfitPanel panel;
	private final ConfigManager configManager;
	private final EventBus eventBus;

	private static final int FIXED_WIDTH = 440;

	public SkillingOutfitWindow(
			SkillingOutfitConfig config,
			SkillingOutfitPanel panel,
			ConfigManager configManager,
			EventBus eventBus,
			ClientThread clientThread
	)
	{
		super("Skilling Outfit Tracker – Config");
		this.config = config;
		this.panel = panel;
		this.configManager = configManager;
		this.eventBus = eventBus;

		setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);
		setSize(500, 700);
		setLocationRelativeTo(null);

		JPanel main = createVerticalPanel();
		leftAlign(main);

		/* ======================================================
		 *  GENERAL SETTINGS
		 * ====================================================== */
		addHeader(main, "General Settings");

		addCheckbox(main, "Display Collected Outfits", "displayCollectedOutfits", config.displayCollectedOutfits());
		addCheckbox(main, "Display Collected Items", "displayCollectedItems", config.displayCollectedItems());
		addCheckbox(main, "Color Text For Collected", "colorTextForCollected", config.colorTextForCollected());

		addCheckbox(main, "Show Price To Obtain (Outfit)", "showTotalObtain", config.showTotalObtain());
		addCheckbox(main, "Show Price To Obtain (Items)", "showItemTotalObtain", config.showItemTotalObtain());
		addCheckbox(main, "Show Obtained Items", "showObtainedItems", config.showObtainedItems());

		addCheckbox(main, "Enable Popout Config Mode", "enablePopoutConfigMode", config.enablePopoutConfigMode());

		JLabel barkLabel = new JLabel("Anima-Infused Bark");
		leftAlign(barkLabel);
		main.add(barkLabel);
		main.add(space());

		// Spinner
		JPanel barkRow = new JPanel();
		barkRow.setLayout(new BoxLayout(barkRow, BoxLayout.X_AXIS));
		barkRow.setAlignmentX(Component.LEFT_ALIGNMENT);

		// the spinner
		JSpinner bark = new JSpinner(new SpinnerNumberModel(config.animaBark(), 0, 999999, 1));
		bark.setPreferredSize(new Dimension(80, 25));
		bark.setMaximumSize(new Dimension(80, 25));
		bark.setMinimumSize(new Dimension(80, 25));
		leftAlign(bark);

		bark.addChangeListener(e -> setConfigValue("animaBark", bark.getValue()));

		barkRow.add(bark);
		main.add(barkRow);
		main.add(space());


		/* ======================================================
		 *  SPACING SETTINGS
		 * ====================================================== */
		addHeader(main, "Spacing Settings");

		addSpinner(main, "Panel Title Spacer", "panelTitleSpacer", config.panelTitleSpacer(), 0, 200);
		addSpinner(main, "Outfit Text Spacer", "outfitTextSpacer", config.outfitTextSpacer(), 0, 100);
		addSpinner(main, "Item Text Spacer", "itemTextSpacer", config.itemTextSpacer(), 0, 100);
		addSpinner(main, "First Outfit Spacer", "firstOutfitSpacer", config.firstOutfitSpacer(), 0, 100);
		addSpinner(main, "Total Needed Text Spacer", "totalNeededTextSpacer", config.totalNeededTextSpacer(), 0, 100);
		addSpinner(main, "Icon Text Spacer", "iconTextSpacer", config.iconTextSpacer(), 0, 100);

		/* ======================================================
		 *  ICON SETTINGS
		 * ====================================================== */
		addHeader(main, "Icon Settings");

		addSpinner(main, "Icon Size", "iconSize", config.iconSize(), 16, 128);
		addSpinner(main, "Icon Gap Spacing", "iconGapSpacing", config.iconGapSpacing(), 0, 100);
		addSpinner(main, "Max Columns", "maxCols", config.maxCols(), 1, 12);

		/* ======================================================
		 *  COLOR OPTIONS
		 * ====================================================== */
		addHeader(main, "Color Options");

		addCheckbox(main, "Override Outfit Colors", "overrideOutfitColors", config.overrideOutfitColors());

		JButton pick = new JButton("Pick Outfit Name Color");
		leftAlign(pick);
		pick.setMaximumSize(new Dimension(180, 28));
		pick.setPreferredSize(new Dimension(180, 28));
		pick.setMinimumSize(new Dimension(120, 28));
		pick.addActionListener(e ->
		{
			Color newColor = JColorChooser.showDialog(this, "Choose Outfit Name Color", config.outfitNameColor());
			if (newColor != null)
				setConfigValue("outfitNameColor", newColor.getRGB());
		});
		main.add(pick);
		main.add(space());

		/* ======================================================
		 *  OUTFIT SETS
		 * ====================================================== */
		addHeader(main, "Outfit Sets");

		Map<String, Boolean> outfits = new LinkedHashMap<>();
		outfits.put("Agility", config.displayAgility());
		outfits.put("Construction", config.displayConstruction());
		outfits.put("Farming", config.displayFarming());
		outfits.put("Firemaking", config.displayFiremaking());
		outfits.put("Fishing", config.displayFishing());
		outfits.put("Hunter", config.displayHunter());
		outfits.put("Mining", config.displayMining());
		outfits.put("Prayer", config.displayPrayer());
		outfits.put("Runecraft", config.displayRunecraft());
		outfits.put("Smithing", config.displaySmithing());
		outfits.put("Thieving", config.displayThieving());
		outfits.put("Woodcutting", config.displayWoodcutting());

		for (Map.Entry<String, Boolean> e : outfits.entrySet())
			addCheckbox(main, "Display " + e.getKey() + " Outfit", "display" + e.getKey(), e.getValue());

		/* ======================================================
		 *  FIX COLLAPSING / LEFT-ALIGN WINDOW
		 * ====================================================== */
		main.setPreferredSize(new Dimension(FIXED_WIDTH, main.getPreferredSize().height));
		main.setMinimumSize(new Dimension(FIXED_WIDTH, 0));
		main.setMaximumSize(new Dimension(FIXED_WIDTH, Integer.MAX_VALUE));

		JScrollPane scroll = new JScrollPane(main);
		scroll.setHorizontalScrollBarPolicy(ScrollPaneConstants.HORIZONTAL_SCROLLBAR_NEVER);
		scroll.getVerticalScrollBar().setUnitIncrement(15);

		add(scroll);
		setVisible(true);
	}

	/* ======================================================
	 *  HELPERS
	 * ====================================================== */

	private JPanel createVerticalPanel()
	{
		JPanel p = new JPanel();
		p.setLayout(new BoxLayout(p, BoxLayout.Y_AXIS));
		p.setAlignmentX(Component.LEFT_ALIGNMENT);
		return p;
	}

	private void addHeader(JPanel p, String text)
	{
		JLabel header = new JLabel("  === " + text + " ===");
		header.setFont(header.getFont().deriveFont(Font.BOLD, 13f));
		fixComponent(header);
		leftAlign(header);
		p.add(header);
		p.add(space());
	}

	private void addCheckbox(JPanel p, String label, String key, boolean initial)
	{
		JCheckBox box = new JCheckBox(label, initial);
		fixComponent(box);
		leftAlign(box);
		box.addActionListener(e -> setConfigValue(key, box.isSelected()));
		p.add(box);
		p.add(space());
	}

	private void addSpinner(JPanel p, String label, String key, int initial, int min, int max)
	{
		JPanel row = new JPanel();
		row.setLayout(new BoxLayout(row, BoxLayout.X_AXIS));
		row.setAlignmentX(Component.LEFT_ALIGNMENT);
		row.setMaximumSize(new Dimension(FIXED_WIDTH, 30));
		row.setMinimumSize(new Dimension(FIXED_WIDTH, 30));
		row.setPreferredSize(new Dimension(FIXED_WIDTH, 30));

		JLabel l = new JLabel(label + ": ");
		l.setAlignmentX(Component.LEFT_ALIGNMENT);

		JSpinner spinner = new JSpinner(new SpinnerNumberModel(initial, min, max, 1));
		spinner.setMaximumSize(new Dimension(80, 25));  // ❗ small spinner width
		spinner.setPreferredSize(new Dimension(80, 25));
		spinner.setMinimumSize(new Dimension(80, 25));
		spinner.setAlignmentX(Component.LEFT_ALIGNMENT);

		spinner.addChangeListener(e -> setConfigValue(key, spinner.getValue()));

		row.add(l);
		row.add(Box.createHorizontalStrut(10)); // nice spacing
		row.add(spinner);

		p.add(row);
		p.add(space());
	}

	private void fixComponent(Component c)
	{
		Dimension pref = c.getPreferredSize();
		Dimension fixed = new Dimension(FIXED_WIDTH, pref.height);

		c.setPreferredSize(fixed);
		c.setMaximumSize(fixed);
		c.setMinimumSize(new Dimension(FIXED_WIDTH, pref.height));
	}

	private void leftAlign(Component c)
	{
		if (c instanceof JComponent)
			((JComponent) c).setAlignmentX(Component.LEFT_ALIGNMENT);
	}

	private Component space()
	{
		Component c = Box.createRigidArea(new Dimension(0, 10));
		fixComponent(c);
		leftAlign(c);
		return c;
	}

	private void setConfigValue(String key, Object value)
	{
		configManager.setConfiguration("skillingoutfit", key, value);

		if (panel != null)
			panel.refresh();

		ConfigChanged evt = new ConfigChanged();
		evt.setGroup("skillingoutfit");
		evt.setKey(key);
		evt.setNewValue(value != null ? value.toString() : null);
		eventBus.post(evt);
	}
}

