package com.telegramnotifier;

import lombok.extern.slf4j.Slf4j;
import okhttp3.*;

import javax.inject.Inject;
import java.io.IOException;
import java.net.*;
import java.nio.charset.StandardCharsets;

@Slf4j

public class TelegramNotifierService
{
    private final TelegramNotifierConfig config;

    @Inject
    private OkHttpClient okHttpClient;

    @Inject
    public TelegramNotifierService(TelegramNotifierConfig config)
    {
        this.config = config;
    }

    public void sendMessage(String message)
    {
        String TELEGRAM_BOT_TOKEN = config.telegramBotToken();
        String CHAT_ID = config.telegramChatId();

        String urlStr = String.format(
                "https://api.telegram.org/bot%s/sendMessage?chat_id=%s&text=%s",
                TELEGRAM_BOT_TOKEN,
                CHAT_ID,
                URLEncoder.encode(message, StandardCharsets.UTF_8)
        );

        Request request = new Request.Builder()
                .url(urlStr)
                .build();

        okHttpClient.newCall(request).enqueue(new Callback()
        {
            @Override
            public void onFailure(Call call, IOException e)
            {
                log.debug("Failed to send Telegram message: ", e);
            }

            @Override
            public void onResponse(Call call, Response response)
            {
                try (response) {
                    if (!response.isSuccessful()) {
                        log.debug("Failed to send Telegram message: {}", response.code());
                    }
                }
            }
        });
    }
}

package com.telegramnotifier;

import com.google.inject.Provides;
import net.runelite.api.events.ChatMessage;
import net.runelite.client.config.ConfigManager;
import net.runelite.client.plugins.Plugin;
import net.runelite.client.plugins.PluginDescriptor;
import javax.inject.Inject;
import net.runelite.client.eventbus.Subscribe;
import lombok.extern.slf4j.Slf4j;

import java.util.concurrent.ScheduledExecutorService;

@Slf4j
@PluginDescriptor(
		name = "Telegram Notifier",
		description = "Sends Telegram messages on valuable drops",
		tags = {"drop", "telegram", "loot", "notify"}
)
public class TelegramNotifierPlugin extends Plugin
{
	@Inject
	private ScheduledExecutorService executor;

	@SuppressWarnings("unused")
	@Provides
	TelegramNotifierConfig provideConfig(ConfigManager configManager)
	{
		return configManager.getConfig(TelegramNotifierConfig.class);
	}

	@Inject
	private TelegramNotifierConfig config;

	@Inject
	private TelegramNotifierService telegramService;

	@SuppressWarnings("unused")
	@Subscribe
	public void onChatMessage(ChatMessage event)
	{
		String message = event.getMessage();

		if (message.matches(config.pattern()))
		{
			executor.execute(() -> telegramService.sendMessage(message));
		}
	}
}

package com.telegramnotifier;

import net.runelite.client.config.Config;
import net.runelite.client.config.ConfigGroup;
import net.runelite.client.config.ConfigItem;

@ConfigGroup("telegramnotifier")
public interface TelegramNotifierConfig extends Config
{
	@ConfigItem(
			keyName = "pattern",
			name = "Message Pattern",
			description = "Regex pattern for messages to send to Telegram"
	)


	default String pattern() {
		return ".*valuable drop*";
	}
	@ConfigItem(
			keyName = "telegramBotToken",
			name = "Telegram Bot Token",
			description = "Your bot token from BotFather"
	)
	default String telegramBotToken()
	{
		return "";
	}

	@ConfigItem(
			keyName = "telegramChatId",
			name = "Telegram Chat ID",
			description = "Your Telegram chat ID"
	)
	default String telegramChatId()
	{
		return "";
	}

}

package com.telegramnotifier;

import net.runelite.client.RuneLite;
import net.runelite.client.externalplugins.ExternalPluginManager;

@SuppressWarnings("unchecked")
public class TelegramNotifierPluginTest
{
	public static void main(String[] args) throws Exception
	{
		ExternalPluginManager.loadBuiltin(TelegramNotifierPlugin.class);
		RuneLite.main(args);
	}
}
