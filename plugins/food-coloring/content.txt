package com.foodcoloring;

import net.runelite.client.config.Config;
import net.runelite.client.config.ConfigGroup;
import net.runelite.client.config.ConfigItem;
import net.runelite.client.config.ConfigSection;

@ConfigGroup(FoodColoringConfig.GROUP)
public interface FoodColoringConfig extends Config
{
	String GROUP = "foodcoloring";

	@ConfigSection(
		name = "Fish",
		description = "Recolorable fish.",
		position = 0,
		closedByDefault = false
	)
	String fishSection = "fish";

	@ConfigSection(
		name = "Hunter meat",
		description = "Recolorable hunter meats.",
		position = 1,
		closedByDefault = false
	)
	String hunterMeatSection = "Hunter meat";

	@ConfigSection(
		name = "Other",
		description = "Other recolorable item options.",
		position = 2,
		closedByDefault = false
	)
	String otherSection = "other";

	//=== Fish Section ===

	@ConfigItem(
			position = 0,
			keyName = "recolorGiantKrill",
			name = "Giant Krill",
			description = "Recoloring of cooked giant krill.",
			section = fishSection
	)
	default boolean recolorGiantKrill()
	{
		return true;
	}

	@ConfigItem(
			position = 1,
			keyName = "recolorHaddock",
			name = "Haddock",
			description = "Recoloring of cooked haddock.",
			section = fishSection
	)
	default boolean recolorHaddock()
	{
		return true;
	}

	@ConfigItem(
			position = 2,
			keyName = "recolorYellowfin",
			name = "Yellowfin",
			description = "Recoloring of cooked yellowfin.",
			section = fishSection
	)
	default boolean recolorYellowfin()
	{
		return true;
	}
/*
	@ConfigItem(
			position = 3,
			keyName = "recolorHalibut",
			name = "Halibut",
			description = "Recoloring of cooked halibut.",
			section = fishSection
	)
	default boolean recolorHalibut()
	{
		return true;
	}
*/
	@ConfigItem(
			position = 4,
			keyName = "recolorBluefin",
			name = "Bluefin",
			description = "Recoloring of cooked bluefin.",
			section = fishSection
	)
	default boolean recolorBluefin()
	{
		return true;
	}

	@ConfigItem(
			position = 5,
			keyName = "recolorRawMarlin",
			name = "Raw Marlin",
			description = "Recoloring of raw marlin that adds a yellow stripe.",
			section = fishSection
	)
	default boolean recolorRawMarlin()
	{
		return true;
	}

	@ConfigItem(
			position = 6,
			keyName = "recolorMarlin",
			name = "Marlin",
			description = "Recoloring of cooked marlin.",
			section = fishSection
	)
	default boolean recolorMarlin()
	{
		return true;
	}

/*	@ConfigItem(
			position = 7,
			keyName = "recolorSwordtipSquid",
			name = "Swordtip Squid",
			description = "Recoloring of cooked swordtip squid.",
			section = fishSection
	)
	default boolean recolorSwordtipSquid()
	{
		return true;
	}

	@ConfigItem(
			position = 8,
			keyName = "recolorJumboSquid",
			name = "Jumbo Squid",
			description = "Recoloring of cooked jumbo squid.",
			section = fishSection
	)
	default boolean recolorJumboSquid()
	{
		return true;
	}*/

	@ConfigItem(
			position = 9,
			keyName = "recolorHalibut",
			name = "Halibut",
			description = "Recoloring of cooked halibut, with multiple choices.",
			section = fishSection
	)
	default HalibutType recolorHalibut()
	{
		return HalibutType.LIGHT;
	}

	//=== Hunter Meats Section ===

	@ConfigItem(
			position = 0,
			keyName = "recolorWildKebbit",
			name = "Wild Kebbit",
			description = "Recoloring of cooked wild kebbit.",
			section = hunterMeatSection
	)
	default boolean recolorWildKebbit()
	{
		return true;
	}

	@ConfigItem(
			position = 1,
			keyName = "recolorLarupia",
			name = "Larupia",
			description = "Recoloring of cooked larupia meat.",
			section = hunterMeatSection
	)
	default boolean recolorLarupia()
	{
		return true;
	}

	@ConfigItem(
			position = 2,
			keyName = "recolorBarbed",
			name = "Barb-Tailed Kebbit",
			description = "Recoloring of cooked barb-tailed kebbit meat.",
			section = hunterMeatSection
	)
	default boolean recolorBarbed()
	{
		return true;
	}

	@ConfigItem(
			position = 3,
			keyName = "recolorGraahk",
			name = "Graahk",
			description = "Recoloring of cooked graahk meat.",
			section = hunterMeatSection
	)
	default boolean recolorGraahk()
	{
		return true;
	}

	@ConfigItem(
			position = 4,
			keyName = "recolorKyatt",
			name = "Kyatt",
			description = "Recoloring of cooked Kyatt meat.",
			section = hunterMeatSection
	)
	default boolean recolorKyatt()
	{
		return true;
	}

	@ConfigItem(
			position = 5,
			keyName = "recolorPyreFox",
			name = "Pyre Fox",
			description = "Recoloring of cooked pyre fox meat.",
			section = hunterMeatSection
	)
	default boolean recolorPyreFox()
	{
		return true;
	}

	@ConfigItem(
			position = 6,
			keyName = "recolorSunlightAntelope",
			name = "Sunlight Antelope",
			description = "Recoloring of cooked sunlight antelope meat.",
			section = hunterMeatSection
	)
	default boolean recolorSunlightAntelope()
	{
		return true;
	}

	@ConfigItem(
			position = 7,
			keyName = "recolorDashingKebbit",
			name = "Dashing Kebbit",
			description = "Recoloring of cooked dashing kebbit meat.",
			section = hunterMeatSection
	)
	default boolean recolorDashingKebbit()
	{
		return true;
	}

	@ConfigItem(
			position = 8,
			keyName = "recolorMoonlightAntelope",
			name = "Moonlight Antelope",
			description = "Recoloring of cooked moonlight antelope meat.",
			section = hunterMeatSection
	)
	default boolean recolorMoonlightAntelope()
	{
		return true;
	}

	//=== Other Section ===

	@ConfigItem(
			position = 0,
			keyName = "recolorSunlightMothMix",
			name = "Sunlight Moth Mix",
			description = "Recolors sunlight moth mix to show a sunlight moth.",
			section = otherSection
	)
	default boolean recolorSunlightMothMix()
	{
		return true;
	}

	@ConfigItem(
			position = 1,
			keyName = "recolorMoonlightMothMix",
			name = "Moonlight Moth Mix",
			description = "Recolors moonlight moth mix to show a moonlight moth.",
			section = otherSection
	)
	default boolean recolorMoonlightMothMix()
	{
		return true;
	}

}

package com.foodcoloring;

import lombok.AllArgsConstructor;
import lombok.Getter;

@AllArgsConstructor
public enum HalibutType {
	NONE("None"),
	LIGHT("Light"),
	GREEN("Green"),
	BROWN("Brown"),
	HALIBWAN("Halibwan");

	@Getter
	private final String name;
}

package com.foodcoloring;

import java.awt.AlphaComposite;
import java.awt.Color;
import java.awt.Graphics2D;
import java.awt.Image;
import java.awt.Point;
import java.awt.Rectangle;
import java.awt.RenderingHints;
import java.net.URL;
import java.util.Arrays;
import java.util.HashMap;
import java.util.Map;
import javax.inject.Inject;
import javax.swing.ImageIcon;
import lombok.extern.slf4j.Slf4j;
import net.runelite.api.gameval.ItemID;
import net.runelite.api.gameval.InterfaceID;
import net.runelite.api.widgets.Widget;
import net.runelite.api.widgets.WidgetItem;
import net.runelite.api.widgets.WidgetType;
import net.runelite.client.ui.FontManager;
import net.runelite.client.ui.overlay.WidgetItemOverlay;
import net.runelite.client.ui.overlay.components.TextComponent;

@Slf4j
public class FoodColoringOverlay extends WidgetItemOverlay
{
	// in-game alpha for placeholder is 120/255, however, overlays are on top of in-game renders, so we dim it further
	static final float PLACEHOLDER_ALPHA = 0.18f;
	static final float OVERLAY_PRIORITY = -1.0f;

	static final int ICON_OFFSET = 5;
	static final int ICON_DIMENSIONS = 22;

	final Map<String, Image> images = new HashMap<>();

	@Inject
	private FoodColoringConfig config;

	@Inject
	private FoodColoringOverlay()
	{
		this.setPriority(OVERLAY_PRIORITY);
		this.showOnInventory();
		this.showOnBank();
		showAfterLayers(
				InterfaceID.Bankmain.ITEMS_CONTAINER,
				InterfaceID.Bankmain.TABS,
				InterfaceID.Chatbox.MES_LAYER,
				InterfaceID.Chatbox.MES_LAYER_SCROLLCONTENTS,
				//InterfaceID.DeathCoffer.DISPLAY, //doesn't work as this uses WidgetType.MODEL (Type=6)
				InterfaceID.DeathCofferSide.ITEMS,
				InterfaceID.Deathkeep.GRAVE,
				InterfaceID.Deathkeep.KEPT,
				InterfaceID.DeathOffice.ITEMS,
				InterfaceID.GeCollect.COLLECT_0,
				InterfaceID.GeCollect.COLLECT_1,
				InterfaceID.GeCollect.COLLECT_2,
				InterfaceID.GeCollect.COLLECT_3,
				InterfaceID.GeCollect.COLLECT_4,
				InterfaceID.GeCollect.COLLECT_5,
				InterfaceID.GeCollect.COLLECT_6,
				InterfaceID.GeCollect.COLLECT_7,
				InterfaceID.GeOffers.DETAILS,
				InterfaceID.GeOffers.DETAILS_COLLECT,
				InterfaceID.GeOffers.SETUP,
				InterfaceID.GeOffers.INDEX_0,
				InterfaceID.GeOffers.INDEX_1,
				InterfaceID.GeOffers.INDEX_2,
				InterfaceID.GeOffers.INDEX_3,
				InterfaceID.GeOffers.INDEX_4,
				InterfaceID.GeOffers.INDEX_5,
				InterfaceID.GeOffers.INDEX_6,
				InterfaceID.GeOffers.INDEX_7,
				InterfaceID.GePricechecker.ITEMS,
				InterfaceID.GravestoneGeneric.FREEITEMS,
				InterfaceID.GravestoneGeneric.PAYITEMS,
				InterfaceID.InvoverlayNoops.ITEMS //also used for bankpin screen
		);
	}

	@Override
	public void renderItemOverlay(final Graphics2D graphics, final int itemId, final WidgetItem widgetItem)
	{           // fishies
		if (shouldRenderItemOverlay(config.recolorGiantKrill(), itemId, ItemID.GIANT_KRILL) ||
				shouldRenderItemOverlay(config.recolorHaddock(), itemId, ItemID.HADDOCK) ||
				shouldRenderItemOverlay(config.recolorYellowfin(), itemId, ItemID.YELLOWFIN) ||
				shouldRenderItemOverlay(config.recolorHalibut() != HalibutType.NONE, itemId, ItemID.HALIBUT) ||
				shouldRenderItemOverlay(config.recolorBluefin(), itemId, ItemID.BLUEFIN) ||
				shouldRenderItemOverlay(config.recolorMarlin(), itemId, ItemID.MARLIN) ||
				//shouldRenderItemOverlay(config.recolorSwordtipSquid(), id, ItemID.SWORDTIP_SQUID) ||
				//shouldRenderItemOverlay(config.recolorJumboSquid(), id, ItemID.JUMBO_SQUID) ||

				// raw fishies
				shouldRenderItemOverlay(config.recolorRawMarlin(), itemId, ItemID.RAW_MARLIN) ||

				// hunter meats
				shouldRenderItemOverlay(config.recolorWildKebbit(), itemId, ItemID.WILDKEBBIT_COOKED) ||
				shouldRenderItemOverlay(config.recolorLarupia(), itemId, ItemID.LARUPIA_COOKED) ||
				shouldRenderItemOverlay(config.recolorBarbed(), itemId, ItemID.BARBKEBBIT_COOKED) ||
				shouldRenderItemOverlay(config.recolorGraahk(), itemId, ItemID.GRAAHK_COOKED) ||
				shouldRenderItemOverlay(config.recolorKyatt(), itemId, ItemID.KYATT_COOKED) ||
				shouldRenderItemOverlay(config.recolorPyreFox(), itemId, ItemID.FENNECFOX_COOKED) ||
				shouldRenderItemOverlay(config.recolorSunlightAntelope(), itemId, ItemID.ANTELOPESUN_COOKED) ||
				shouldRenderItemOverlay(config.recolorDashingKebbit(), itemId, ItemID.DASHINGKEBBIT_COOKED) ||
				shouldRenderItemOverlay(config.recolorMoonlightAntelope(), itemId, ItemID.ANTELOPEMOON_COOKED) ||

				// hunter mixes
				shouldRenderItemOverlay(config.recolorSunlightMothMix(), itemId, ItemID.HUNTER_MIX_SUNMOTH_2DOSE) ||
				shouldRenderItemOverlay(config.recolorSunlightMothMix(), itemId, ItemID.HUNTER_MIX_SUNMOTH_1DOSE) ||
				shouldRenderItemOverlay(config.recolorMoonlightMothMix(), itemId, ItemID.HUNTER_MIX_MOONMOTH_2DOSE) ||
				shouldRenderItemOverlay(config.recolorMoonlightMothMix(), itemId, ItemID.HUNTER_MIX_MOONMOTH_1DOSE))
		{
			renderCorrectItemOverlay(graphics, itemId, widgetItem);

			// 786442 - we ignore here since all Bank Tag sidebar icon widgets have item qty = 10,000,
			// and ignore tabs due to faked qty text
			final Widget widget = widgetItem.getWidget();
			final int widgetId = widget.getId();
			if (widget.getType() == WidgetType.GRAPHIC && (widgetId == InterfaceID.Bankmain.ITEMS_CONTAINER || widgetId == InterfaceID.Bankmain.TABS))
			{
				return;
			}

			final int qty = widgetItem.getQuantity();
			if (qty > 1)
			{
				graphics.setFont(FontManager.getRunescapeSmallFont());
				renderText(graphics, widgetItem.getCanvasBounds(), qty);
			}
		}
	}


	private boolean shouldRenderItemOverlay(boolean configEnabled, int itemId, int baseId)
	{
		return configEnabled && (itemId >= baseId) && (itemId <= baseId + 2);
	}


	private void renderCorrectItemOverlay(final Graphics2D graphics, final int id, final WidgetItem widgetItem)
	{
		final Rectangle bounds = widgetItem.getCanvasBounds();
		final double x = bounds.getX();
		final double y = bounds.getY();
		Image iconImage = this.getReplacementIcon(id);

		// item icon
		if (iconImage != null)
		{
			graphics.drawImage(iconImage, (int) x, (int) y, null);
			return;
		}

		// banknote icon
		iconImage = this.getReplacementIcon(id-1);
		if (iconImage != null)
		{
			Graphics2D g2d = (Graphics2D) graphics.create();
			g2d.setRenderingHint(RenderingHints.KEY_INTERPOLATION, RenderingHints.VALUE_INTERPOLATION_BICUBIC);
			g2d.drawImage(iconImage, (int) x + ICON_OFFSET, (int) y + ICON_OFFSET, ICON_DIMENSIONS, ICON_DIMENSIONS, null);
			g2d.dispose();
			return;
		}

		// placeholder icon
		iconImage = this.getReplacementIcon(id-2);
		if (iconImage != null)
		{
			Graphics2D g2d = (Graphics2D) graphics.create();
			g2d.setComposite(AlphaComposite.getInstance(AlphaComposite.SRC_OVER, PLACEHOLDER_ALPHA));
			g2d.drawImage(iconImage, (int) x, (int) y + 1, null);
			g2d.dispose();
			return;
		}

		log.debug("Food Coloring plugin could not find image resource for item id: " + id);
	}

	private void renderText(Graphics2D graphics, Rectangle bounds, int count)
	{
		final TextComponent textComponent = new TextComponent();
		textComponent.setPosition(new Point(bounds.x, bounds.y + 10));
		textComponent.setColor(Color.YELLOW);
		textComponent.setText(Integer.toString(count));
		textComponent.render(graphics);
	}

	private Image getReplacementIcon(final int id)
	{
		String key = Integer.toString(id);
		if (config.recolorHalibut() != HalibutType.NONE && id == ItemID.HALIBUT)
		{
			key += "_" + config.recolorHalibut().getName();
		}
		if (!this.images.containsKey(key))
		{
			final URL resourceUrl = FoodColoringPlugin.class.getClassLoader().getResource(key + ".png");
			if (resourceUrl == null)
			{
				return null;
			}
			this.images.put(key, new ImageIcon(resourceUrl).getImage());
		}
		return this.images.get(key);
	}


	private void showAfterLayers(int... ids) {
		Arrays.stream(ids).forEach(this::drawAfterLayer);
	}
}
package com.foodcoloring;

import com.google.inject.Provides;
import javax.inject.Inject;
import lombok.extern.slf4j.Slf4j;
import net.runelite.api.Client;
import net.runelite.client.config.ConfigManager;
import net.runelite.client.plugins.Plugin;
import net.runelite.client.plugins.PluginDescriptor;
import net.runelite.client.ui.overlay.OverlayManager;

@Slf4j
@PluginDescriptor(
	name = "Food Coloring"
)
public class FoodColoringPlugin extends Plugin
{
	@Inject
	private OverlayManager overlayManager;

	@Inject
	private FoodColoringOverlay foodColoringOverlay;

	@Inject
	private Client client;

	@Inject
	private FoodColoringConfig config;

	@Override
	protected void startUp() throws Exception
	{
		overlayManager.add(foodColoringOverlay);
	}

	@Override
	protected void shutDown() throws Exception
	{
		overlayManager.remove(foodColoringOverlay);
	}

	@Provides
	FoodColoringConfig provideConfig(ConfigManager configManager)
	{
		return configManager.getConfig(FoodColoringConfig.class);
	}
}

package com.foodcoloring;

import net.runelite.client.RuneLite;
import net.runelite.client.externalplugins.ExternalPluginManager;

public class FoodColoringPluginTest
{
	public static void main(String[] args) throws Exception
	{
		ExternalPluginManager.loadBuiltin(FoodColoringPlugin.class);
		RuneLite.main(args);
	}
}
